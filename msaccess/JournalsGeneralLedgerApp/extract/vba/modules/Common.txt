Option Compare Text
Dim TheOperator(1 To 49)
Dim TheOperand(1 To 49)
Global Billapp, g_BeforeUpdate As Variant, g_CurrentRev As String, g_ThisForm As String
Global g_ApplicationNumber, g_JobForm As String
Global g_SelectedRecord, g_Scroll, g_Count, g_ElapsedTime, g_ElapsedTimer
Global g_Facets As Variant
Global g_EndPointX As Double, g_ConnectRemotely As Boolean
Global g_EndPointY As Double
Global g_CenterPointX As Double
Global g_CenterPointY As Double
Global g_IntermediatePointX As Double
Global g_IntermediatePointY As Double
Global g_Degrees As Double, g_Date As Date, g_Detail As Boolean
Global px(1 To 3) As Double
Global py(1 To 3) As Double
Global pz(1 To 3) As Double
Global g_Echo, g_EchoFix
Global g_Password, g_Pieces, g_APPName, g_TheAppName, g_passNumber
Global g_PasswordName, g_ThisCondition, g_YTD As Boolean, g_COGS, g_DetailAccount
Global g_delete As Boolean, g_TheDate As Date, g_FormatCount
Declare PtrSafe Function GetUserName& Lib "advapi32.dll" Alias "GetUserNameA" (ByVal lpbuffer As String, nsize As Long)

Global g_IncomeBudget, g_ExpenseBudget, g_IncomeSubtotalBudget, g_ExpenseSubtotalBudget, g_CumulativeBudget
Global g_subsubTotal As Currency, g_subTotal, g_Income, g_Expense
Global g_subsubTotalYTD, g_subTotalYTD, g_IncomeYTD, g_ExpenseYTD
Global g_subsubTotalPrior, g_subTotalPrior, g_IncomePrior, g_ExpensePrior
Global g_Design, g_Cabinet, g_Install, g_OS, g_BeginDate As Date, g_EndDate As Date, g_totalEquity
Global g_DesignBudget, g_CabinetBudget, g_InstallBudget, g_OSBudget, g_totalEquityBudget
Global g_DesignYTD, g_CabinetYTD, g_InstallYTD, g_OSYTD, g_BeginDateYTD As Date, g_EndDateYTD As Date, g_totalEquityYTD
Global g_BeginDatePrior As Date, g_EndDatePrior As Date, g_totalEquityPrior
Global g_Undistributed, g_DesignSale, g_CabinetSale, g_InstallSale, g_OSSale, g_indexSearch, g_Balance, g_IncomeSubtotal, g_ExpenseSubtotal
Global g_UndistributedBudget, g_DesignSaleBudget, g_CabinetSaleBudget, g_InstallSaleBudget, g_OSSaleBudget
Global g_UndistributedYTD, g_DesignSaleYTD, g_CabinetSaleYTD, g_InstallSaleYTD, g_OSSaleYTD, g_indexSearchYTD, g_BalanceYTD, g_IncomeSubtotalYTD, g_ExpenseSubtotalYTD
Global g_indexSearchPrior, g_BalancePrior, g_IncomeSubtotalPrior, g_ExpenseSubtotalPrior
Global g_Total_Detail
Global g_Total_DetailYTD
Global g_Total_DetailPrior

Public Const MAX_WSADescription As Long = 256
Public Const MAX_WSASYSStatus As Long = 128
Public Const ERROR_SUCCESS       As Long = 0
Public Const WS_VERSION_REQD     As Long = &H101
Public Const WS_VERSION_MAJOR    As Long = WS_VERSION_REQD \ &H100 And &HFF&
Public Const WS_VERSION_MINOR    As Long = WS_VERSION_REQD And &HFF&
Public Const MIN_SOCKETS_REQD    As Long = 1
Public Const SOCKET_ERROR        As Long = -1

Public Type HOSTENT
   hName      As Long
   hAliases   As Long
   hAddrType  As Integer
   hLen       As Integer
   hAddrList  As Long
End Type

Public Type WSADATA
   wVersion      As Integer
   wHighVersion  As Integer
   szDescription(0 To MAX_WSADescription)   As Byte
   szSystemStatus(0 To MAX_WSASYSStatus)    As Byte
   wMaxSockets   As Integer
   wMaxUDPDG     As Integer
   dwVendorInfo  As Long
End Type

Public Declare PtrSafe Function WSAGetLastError Lib "wsock32" () As Long

Public Declare PtrSafe Function WSAStartup Lib "wsock32" _
  (ByVal wVersionRequired As Long, _
   lpWSADATA As WSADATA) As Long
   
Public Declare PtrSafe Function WSACleanup Lib "wsock32" () As Long

Public Declare PtrSafe Function gethostname Lib "wsock32" _
  (ByVal szHost As String, _
   ByVal dwHostLen As Long) As Long
   
Public Declare PtrSafe Function gethostbyname Lib "wsock32" _
  (ByVal szHost As String) As Long
   
Public Declare PtrSafe Sub CopyMemory Lib "kernel32" _
   Alias "RtlMoveMemory" _
  (hpvDest As Any, _
   ByVal hpvSource As Long, _
   ByVal cbCopy As Long)


Public Function GetIPAddress() As String

Dim TheServerPath As String
Close #2
Open "C:\ACCESS\ServerPath.TXT" For Input As #2
Input #2, ServerPath
Close #2

GetIPAddress = ServerPath
Exit Function
   Dim sHostName    As String * 256
   Dim lpHost    As Long
   Dim HOST      As HOSTENT
   Dim dwIPAddr  As Long
   Dim tmpIPAddr() As Byte
   Dim i         As Integer
   Dim sIPAddr  As String
   
   If Not SocketsInitialize() Then
      GetIPAddress = ""
      Exit Function
   End If
    
  'gethostname returns the name of the local host into
  'the buffer specified by the name parameter. The host
  'name is returned as a null-terminated string. The
  'form of the host name is dependent on the Windows
  'Sockets provider - it can be a simple host name, or
  'it can be a fully qualified domain name. However, it
  'is guaranteed that the name returned will be successfully
  'parsed by gethostbyname and WSAAsyncGetHostByName.

  'In actual application, if no local host name has been
  'configured, gethostname must succeed and return a token
  'host name that gethostbyname or WSAAsyncGetHostByName
  'can resolve.
   If gethostname(sHostName, 256) = SOCKET_ERROR Then
      GetIPAddress = ""
      MsgBox "Windows Sockets error " & Str$(WSAGetLastError()) & _
              " has occurred. Unable to successfully get Host Name."
      SocketsCleanup
      Exit Function
   End If
   
  'gethostbyname returns a pointer to a HOSTENT structure
  '- a structure allocated by Windows Sockets. The HOSTENT
  'structure contains the results of a successful search
  'for the host specified in the name parameter.

  'The application must never attempt to modify this
  'structure or to free any of its components. Furthermore,
  'only one copy of this structure is allocated per thread,
  'so the application should copy any information it needs
  'before issuing any other Windows Sockets function calls.

  'gethostbyname function cannot resolve IP address strings
  'passed to it. Such a request is treated exactly as if an
  'unknown host name were passed. Use inet_addr to convert
  'an IP address string the string to an actual IP address,
  'then use another function, gethostbyaddr, to obtain the
  'contents of the HOSTENT structure.
   sHostName = Trim$(sHostName)
   lpHost = gethostbyname(sHostName)
    
   If lpHost = 0 Then
      GetIPAddress = ""
      MsgBox "Windows Sockets are not responding. " & _
              "Unable to successfully get Host Name."
      SocketsCleanup
      Exit Function
   End If
    
  'to extract the returned IP address, we have to copy
  'the HOST structure and its members
   CopyMemory HOST, lpHost, Len(HOST)
   CopyMemory dwIPAddr, HOST.hAddrList, 4
   
  'create an array to hold the result
   ReDim tmpIPAddr(1 To HOST.hLen)
   CopyMemory tmpIPAddr(1), dwIPAddr, HOST.hLen
   
  'and with the array, build the actual address,
  'appending a period between members
   For i = 1 To HOST.hLen
      sIPAddr = sIPAddr & tmpIPAddr(i) & "."
   Next
  
  'the routine adds a period to the end of the
  'string, so remove it here
   GetIPAddress = Mid$(sIPAddr, 1, Len(sIPAddr) - 1)
   
   SocketsCleanup
    
End Function


Public Function GetIPHostName() As String

    Dim sHostName As String * 256
    
    If Not SocketsInitialize() Then
        GetIPHostName = ""
        Exit Function
    End If
    
    If gethostname(sHostName, 256) = SOCKET_ERROR Then
        GetIPHostName = ""
        MsgBox "Windows Sockets error " & Str$(WSAGetLastError()) & _
                " has occurred.  Unable to successfully get Host Name."
        SocketsCleanup
        Exit Function
    End If
    
    GetIPHostName = Left$(sHostName, InStr(sHostName, Chr(0)) - 1)
    SocketsCleanup

End Function

Public Function NotAPP()

Set mydb = CurrentDb()
If InStr(mydb.Name, "App") <> 0 Then NotAPP = False Else NotAPP = True

End Function

Public Function HiByte(ByVal wParam As Integer) As Byte
  
  'note: VB4-32 users should declare ptrsafe this function As Integer
   HiByte = (wParam And &HFF00&) \ (&H100)
 
End Function


Public Function LoByte(ByVal wParam As Integer) As Byte

  'note: VB4-32 users should declare ptrsafe this function As Integer
   LoByte = wParam And &HFF&

End Function


Public Sub SocketsCleanup()

    If WSACleanup() <> ERROR_SUCCESS Then
        MsgBox "Socket error occurred in Cleanup."
    End If
    
End Sub

Public Function SocketsInitialize() As Boolean

   Dim WSAD As WSADATA
   Dim sLoByte As String
   Dim sHiByte As String
   
   If WSAStartup(WS_VERSION_REQD, WSAD) <> ERROR_SUCCESS Then
      MsgBox "The 32-bit Windows Socket is not responding."
      SocketsInitialize = False
      Exit Function
   End If
   
   
   If WSAD.wMaxSockets < MIN_SOCKETS_REQD Then
        MsgBox "This application requires a minimum of " & _
                CStr(MIN_SOCKETS_REQD) & " supported sockets."
        
        SocketsInitialize = False
        Exit Function
    End If
   
   
   If LoByte(WSAD.wVersion) < WS_VERSION_MAJOR Or _
     (LoByte(WSAD.wVersion) = WS_VERSION_MAJOR And _
      HiByte(WSAD.wVersion) < WS_VERSION_MINOR) Then
      
      sHiByte = CStr(HiByte(WSAD.wVersion))
      sLoByte = CStr(LoByte(WSAD.wVersion))
      
      MsgBox "Sockets version " & sLoByte & "." & sHiByte & _
             " is not supported by 32-bit Windows Sockets."
      
      SocketsInitialize = False
      Exit Function
      
   End If
    
    
  'must be OK, so lets do it
   SocketsInitialize = True
        
End Function



Public Function TheUsername()

Dim s$, cnt&, dl&
cnt& = 199
s$ = String$(200, 0)
dl& = GetUserName(s$, cnt)
TheUsername = Left(s$, cnt - 1)

End Function


Public Function ListMonthBegin(fld As Control, ID As Variant, row As Variant, col As Variant, code As Variant) As Variant
    Dim intOffset As Integer
    Select Case code
        Case acLBInitialize            ' Initialize.
            ListMonthBegin = True
        Case acLBOpen                    ' Open.
            ListMonthBegin = Timer        ' Unique ID.
        Case acLBGetRowCount            ' Get rows.
            ListMonthBegin = 121
        Case acLBGetColumnCount    ' Get columns.
            ListMonthBegin = 1
        Case acLBGetColumnWidth    ' Get column width.
            ListMonthBegin = -1            ' Use default width.
        Case acLBGetValue                ' Get the data.
            g_TheDate = Date - Day(Date) + 1
            For i = 1 To row
                g_TheDate = g_TheDate - Day(g_TheDate - 1)
            Next i
            ListMonthBegin = g_TheDate
    End Select
End Function

Public Function ListMonthEnd(fld As Control, ID As Variant, row As Variant, col As Variant, code As Variant) As Variant
    Dim intOffset As Integer
    Select Case code
        Case acLBInitialize            ' Initialize.
            ListMonthEnd = True
        Case acLBOpen                    ' Open.
            ListMonthEnd = Timer        ' Unique ID.
        Case acLBGetRowCount            ' Get rows.
            ListMonthEnd = 121
        Case acLBGetColumnCount    ' Get columns.
            ListMonthEnd = 1
        Case acLBGetColumnWidth    ' Get column width.
            ListMonthEnd = -1            ' Use default width.
        Case acLBGetValue                ' Get the data.
            g_TheDate = Date + 90 - Day(Date + 90) + 1
            For i = 1 To row
                g_TheDate = g_TheDate - Day(g_TheDate - 1)
            Next i
            ListMonthEnd = g_TheDate - 1
    End Select
End Function

Public Function FirstThursday(TheDate As Date) As Date

Do Until Weekday(TheDate) = vbThursday
    TheDate = TheDate + 1
    If Day(TheDate) = 1 Then
        Do Until Weekday(TheDate) = vbThursday
        TheDate = TheDate - 1
        Loop
        Exit Do
    End If
Loop
FirstThursday = TheDate 'Month([TheDate]) & "/" & Weekday([TheDate]) & "/" & Year([TheDate])

End Function

Public Function accountbalance(FromAccount, ToAccount)

SetMyDB
Dim myset As DAO.Recordset, TheResult As Currency
Set myset = mydb.OpenRecordset("Select * from [General Ledger] where Transactiondate >=" & Forms!GeneralLedger!FromDate & " and Transactiondate <=" & Forms!GeneralLedger!ToDate, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    myset.MoveFirst
    Do Until myset.EOF
        If myset!AccountNumber >= FromAccount And myset!AccountNumber <= ToAccount Then TheResult = TheResult + myset!CreditAmount + myset!DebitAmount
        myset.MoveNext
    Loop
End If


End Function
Public Function GLAccess() As Boolean

TheJob = SQLResult("select Text2 from [MIS Personnel] where Text3 = '" & TheUsername & "'")
If InStr(TheJob, "COO") <> 0 Or InStr(TheJob, "IT") <> 0 Then
    GLAccess = True
Else
    GLAccess = False
End If

End Function
Public Function ListWeekBegin(fld As Control, ID As Variant, row As Variant, col As Variant, code As Variant) As Variant
    Dim intOffset As Integer
    Select Case code
        Case acLBInitialize            ' Initialize.
            ListWeekBegin = True
        Case acLBOpen                    ' Open.
            ListWeekBegin = Timer        ' Unique ID.
        Case acLBGetRowCount            ' Get rows.
            ListWeekBegin = 121 * 4
        Case acLBGetColumnCount    ' Get columns.
            ListWeekBegin = 1
        Case acLBGetColumnWidth    ' Get column width.
            ListWeekBegin = -1            ' Use default width.
        Case acLBGetValue                ' Get the data.
            g_TheDate = Date + 90 - Day(Date + 90) + 1
            Do Until Weekday(g_TheDate) = vbMonday
                g_TheDate = g_TheDate - 1
            Loop
            For i = 1 To row
                g_TheDate = g_TheDate - 7
            Next i
            ListWeekBegin = g_TheDate
    End Select
End Function

Public Function DateToday()

DateToday = Date

End Function

Public Function ConvertedNumber(TheNumber As Double, NumberSystem As String, DecimalPlaces As Integer, Fraction As Integer) As String

EchoOn
If InStr(NumberSystem, "millimeter") <> 0 Then
ElseIf InStr(NumberSystem, "mm") <> 0 Then
Else
    TheNumber = TenThousandths(TheNumber / 25.4)
    If InStr(NumberSystem, "decimal inch") <> 0 Then
    ElseIf InStr(NumberSystem, "/") = 0 Then
    Else
        Dim TheWhole As Double
        Dim ThisNumber As String, TheNumerator As String
        Dim Numerator As Double, Denominator As Long
        If TheNumber \ 1 <> TheNumber Then
            ThisNumber = Str(TheNumber)
            M = InStr(ThisNumber, ".")
            If TheNumber >= 1 Then
                TheWhole = Left(ThisNumber, M - 1)
            Else
                TheWhole = 0
            End If
            TheNumerator = Val(Right(ThisNumber, Len(ThisNumber) - M + 1))
            Numerator = Val(TheNumerator)
            Denominator = Fraction
            Numerator = (Fraction * Numerator) \ 1
            LCD = LowestCommonDenominator(Numerator, Denominator)
            Numerator = ConditionNumber(Numerator / LCD)
            Denominator = Denominator / LCD
            If Numerator = 0 Then
                ConvertedNumber = TheWhole
            ElseIf Numerator = Denominator Then
                ConvertedNumber = TheWhole + (Numerator / Denominator)
            ElseIf Val(TheWhole) <> 0 Then
                ConvertedNumber = TheWhole & " " & Numerator & "/" & Denominator
            Else
                ConvertedNumber = Numerator & "/" & Denominator
            End If
        Else
            ConvertedNumber = TheNumber
        End If
        Exit Function
    End If
End If
If DecimalPlaces = 4 Then
    ConvertedNumber = TenThousandths(TheNumber)
ElseIf DecimalPlaces = 3 Then
    ConvertedNumber = Thousandths(TheNumber)
ElseIf DecimalPlaces = 2 Then
    ConvertedNumber = Hundredths(TheNumber)
ElseIf DecimalPlaces = 1 Then
    ConvertedNumber = Tenths(TheNumber)
Else
    ConvertedNumber = TheNumber \ 1
End If

End Function

Private Function LowestCommonDenominator(Numerator As Double, Denominator As Long)

For i = Numerator To 1 Step -1
    M = Denominator / i
    If M \ 1 = M Then
        M = Numerator / i
        If M \ 1 = M Then
            LowestCommonDenominator = i
            Exit Function
        End If
    End If
Next i
LowestCommonDenominator = 1

End Function

Sub CircumCenter(k_px, k_py, cX, cY, Cr)

Variant1 = px(1) - px(3)
Variant2 = py(1) - py(3)
Variant3 = Variant1 * (px(1) + px(3)) / 2 + Variant2 * (py(1) + py(3)) / 2
Variant4 = px(2) - px(3)
Variant5 = py(2) - py(3)
Variant6 = Variant4 * (px(2) + px(3)) / 2 + Variant5 * (py(2) + py(3)) / 2
Variant7 = Variant1 * Variant5 - Variant2 * Variant4

cX = 0#
cY = 0#
Cr = 0#

If (Variant7 <> 0#) Then
    cX = (Variant3 * Variant5 - Variant6 * Variant2) / Variant7
    cY = (Variant1 * Variant6 - Variant4 * Variant3) / Variant7
    Cr = Sqr((px(3) - cX) ^ 2 + (py(3) - cY) ^ 2)
End If

End Sub

Function CalcString(ThePlaces, TheLine)

If NNEN(TheLine) = "" Then Exit Function
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "=+")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "= +" & Right(TheLine, Len(TheLine) - M - 1)
  Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "=-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "= -" & Right(TheLine, Len(TheLine) - M - 1)
  Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "=>")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & ">= " & Right(TheLine, Len(TheLine) - M - 1)
  Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "=<")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "<= " & Right(TheLine, Len(TheLine) - M - 1)
  Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "--")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "+" & Right(TheLine, Len(TheLine) - M - 1)
  Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "+-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & Right(TheLine, Len(TheLine) - M)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "++")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & Right(TheLine, Len(TheLine) - M)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "+*")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & Right(TheLine, Len(TheLine) - M)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "+/")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & Right(TheLine, Len(TheLine) - M)
 Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "*-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "* -" & Right(TheLine, Len(TheLine) - M - 1)
 Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "/-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "/ -" & Right(TheLine, Len(TheLine) - M - 1)
 Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "\-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "\ -" & Right(TheLine, Len(TheLine) - M - 1)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "*+")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "*" & Right(TheLine, Len(TheLine) - M - 1)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "/+")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "/" & Right(TheLine, Len(TheLine) - M - 1)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "\+")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "\" & Right(TheLine, Len(TheLine) - M - 1)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "<-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "< -" & Right(TheLine, Len(TheLine) - M - 1)
 Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, ">-")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "> -" & Right(TheLine, Len(TheLine) - M - 1)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "<+")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "<" & Right(TheLine, Len(TheLine) - M - 1)
 Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, ">+")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & ">" & Right(TheLine, Len(TheLine) - M - 1)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "False<")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "0 and 0 <" & Right(TheLine, Len(TheLine) - M - 5)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "False>")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "0 and 0 >" & Right(TheLine, Len(TheLine) - M - 5)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "False=")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "0 and 0 =" & Right(TheLine, Len(TheLine) - M - 5)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "<False")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "< 0 and 0" & Right(TheLine, Len(TheLine) - M - 5)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, ">False")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "> 0 and 0" & Right(TheLine, Len(TheLine) - M - 5)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "=False")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "= 0 and 0" & Right(TheLine, Len(TheLine) - M - 5)
Loop
'GoTo CalcTheString
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "False <")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "0 and 0 <" & Right(TheLine, Len(TheLine) - M - 6)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "False >")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "0 and 0 >" & Right(TheLine, Len(TheLine) - M - 6)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "False =")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "0 and 0 =" & Right(TheLine, Len(TheLine) - M - 6)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "< False")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "< 0 and 0" & Right(TheLine, Len(TheLine) - M - 6)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "> False")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "> 0 and 0" & Right(TheLine, Len(TheLine) - M - 6)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "= False")
    If M <> 0 Then TheLine = Left(TheLine, M - 1) & "= 0 and 0" & Right(TheLine, Len(TheLine) - M - 6)
Loop
M = 1
Do Until M = 0
    M = InStr(1, TheLine, "log")
    If M <> 0 Then
        TheLine = Left(TheLine, M - 1) & Right(TheLine, Len(TheLine) - M - 2)
        ShowResult = True
    End If
Loop
'If InStr(TheLine, "Sqr") <> 0 Then ErrorLogEntry TheLine: ShowResult = True
CalcTheString:
If Right(TheLine, 1) = "+" Or Right(TheLine, 1) = "-" Or Right(TheLine, 1) = "*" Or Right(TheLine, 1) = "/" Then TheLine = Left(TheLine, Len(TheLine) - 1)
If NNEN(TheLine) = "" Then Exit Function
TheCalcString = Hundredths(Form_Parser.Parse(TheLine))
CalcString = TheCalcString
If ShowResult Then ErrorLogEntry "Result " & TheCalcString

End Function


Function pi() As Single

pi = 4 * Atn(1)

End Function

Sub RotZ(XCoordinate, YCoordinate, angle)

Dim XNew As Currency
Dim YNew As Currency
XNew = XCoordinate * Cos(angle) - YCoordinate * Sin(angle)
YNew = XCoordinate * Sin(angle) + YCoordinate * Cos(angle)
XCoordinate = Thousandths(XNew)
YCoordinate = Thousandths(YNew)

End Sub


Sub RotX(XCoordinate, YCoordinate, ZCoordinate, angle)

YNew = YCoordinate * Cos(angle) - ZCoordinate * Sin(angle)
ZNew = YCoordinate * Sin(angle) + ZCoordinate * Cos(angle)
YCoordinate = YNew
ZCoordinate = ZNew

End Sub
Sub VAV(X1, y1, deg, X2, y2, cX, cY, Cr, ca)

'function [cx, cy, cr, ca] = VAV(x1, y1, deg, x2, y2)

' VAV -- Vertex-Angle-Vertex circle solution.
'  [CX,CY,CR,CA]=VAV(X1,Y1,DEG,X2,Y2) returns the
'   center (CX,CY), radius CR, and angle CA (degrees)
'   subtended by the circular arc lying between vertices
'   (X1,Y1) and (X2,Y2), spanning angle DEG in degrees.
'  VAV (no argument) demonstrates itself.
 
' Copyright (C) 1995 Dr. Charles R. Denham, ZYDECO.
' All Rights Reserved.
 
' Version of 23-Jan-95 at 09:55:26.4.

On Error Resume Next
rcf = 180 / pi()   ' Radian conversion factor.


' Setup.

dx = (X2 - X1) / 2
dy = (y2 - y1) / 2
DD = Sqr(dx * dx + dy * dy)
TT = Tan((deg / 2) / rcf)

' Center of circle.

cX = Hundredths(X1 + dx - (dy / TT))
cY = Hundredths(y1 + dy + (dx / TT))

' Radius of circle.

dx = X1 - cX
dy = y1 - cY
Cr = Hundredths(Sqr(dx * dx + dy * dy))

' Angle subtended (computed).

ca = 2 * Atn(DD / Sqr(Cr * Cr - DD * DD)) * rcf

End Sub

Function Tenths(TheNumber)

Tenths = ConditionNumber(Format(TheNumber, "#.0"))

End Function

Public Sub SizeFormTo(X, Y)

DoCmd.MoveSize , , X * 1440, Y * 1440

End Sub


Public Function LocalVariable(TheName)

On Error GoTo LocalVariableError
TheKey = LocalSettings!Key
LocalSettings.FindFirst " [LocalSettingText5] = '" & TheName & "' "
        'MsgBox ""
If LocalSettings.NoMatch Then
    EchoOff
    If Left(TheName, 5) = "Form_" Then
        Dim TheForm As String, dbs As Database, ctr As Container, doc As Document, ctl As Control
        i = 6
        Do Until Mid(TheName, i, 1) = "_": i = i + 1: Loop
        TheForm = Mid(TheName, 6, i - 6)
        Set dbs = CurrentDb
        Set ctr = dbs.Containers!Forms
        For Each doc In ctr.Documents
            If doc.Name = TheForm Then
                Exit For
            End If
        Next doc
         If Not FIsLoaded(TheForm) Then
            Closeform = True
            DoCmd.OpenForm TheForm, acHidden
        End If
        For i = 0 To Forms.Count - 1
            If Forms(i).FormName = TheForm Then Exit For
        Next i
        TheVariable = ""
        TheNumber = i
        For Each ctl In Forms(TheNumber).Controls
            If TheName = "Form_" & TheForm & "_" & ctl.Name Then
                For i = 0 To ctl.Properties.Count - 1
                    If InStr(ctl.Properties.Item(i).Name, "DefaultValue") <> 0 Then
                        TheVariable = ctl.Properties.Item(i).Value
                        'MsgBox "Initialized " & ctl.Name & " to " & ctl.Properties.Item(I).Value
                        Exit For
                    End If
                Next i
                Exit For
            End If
        Next
    End If
    SetLocalVariable TheName, TheVariable
    LocalVariable = TheVariable
    If Closeform = True Then DoCmd.Close acForm, TheForm
    EchoOn
Else
    LocalVariable = NNEN(LocalSettings!LocalSettingText6)
End If
LocalSettings.FindFirst " [Key] = " & TheKey
Exit Function

LocalVariableError:
'MsgBox Err.Description
GetSettings
Resume ResumeLocalVariableError
ResumeLocalVariableError:

End Function



Sub FormatTime(ElapsedTime, TheMinutes, TheSeconds)

ElapsedTime = (ElapsedTime * 10 \ 1) / 10
If ElapsedTime > 59 Then
    TheMinutes = ElapsedTime \ 60
    TheSeconds = Tenths(ElapsedTime - TheMinutes * 60) & " seconds"
    If ElapsedTime > 119 Then TheMinutes = TheMinutes & " minutes" Else TheMinutes = TheMinutes & " minute"
Else
    TheMinutes = ""
    TheSeconds = ElapsedTime & " seconds"
End If

End Sub
Public Function NotNull(TheString)

If IsNull(TheString) Then
ElseIf TheString = "" Then
Else
    NotNull = True
End If

End Function

Public Sub EchoNo(TheMessage)

g_Echo = False
DoCmd.Hourglass True
'docmd.Echo False
Access.Application.Echo False, TheMessage

End Sub

Public Sub EchoOff()

g_Echo = False
DoCmd.Hourglass True
Access.Application.Echo False

End Sub

Public Sub EchoOn()

On Error Resume Next
If g_EchoFix Then Exit Sub
g_Echo = True
DoCmd.Hourglass False
Access.Application.Echo (True)

End Sub

Public Function DesignView()

On Error Resume Next
'If Not Password("KRH") Then Exit Function
DoCmd.RunCommand acCmdDesignView
SizeAccess 0, 0, 0.5 * 1440, 0.5 * 1440

End Function

Public Function DesignReportView()

On Error Resume Next
DoCmd.RunCommand acCmdDesignView
If TheUsername = "Marshall" Then
    DoCmd.ShowToolbar "Report Design", acToolbarYes
End If

End Function

Public Sub SaveRecord()

On Error Resume Next
DoCmd.DoMenuItem acFormBar, acFile, acSaveRecord
'docmd.RunCommand acCmdSaveRecord
'save record
'docmd.DoMenuItem 0, 0, 4
g_SaveProductList = False

End Sub

Public Sub UndoRecord()

On Error Resume Next
SendKeys "{ESC}"
'RunCommand (acCmdUndo)
'SaveRecord
'DoCmd.DoMenuItem 0, 1, 0
'SaveRecord

End Sub


Public Sub PositionForm()

PositionWideForm
Exit Sub

End Sub

Public Sub PositionWideForm()

On Error Resume Next

Dim TurnEchoOn As Boolean
If g_Echo Then
    TurnEchoOn = True
    DoCmd.Echo False
End If
DoCmd.ShowToolbar "Report Design", acToolbarNo
DoCmd.ShowToolbar "Form Design", acToolbarNo
SetMenu
ListWidth = 12 * 1440
ListHeight = 9.9 * 1440
DoCmd.MoveSize 0, 0, ListWidth, ListHeight
For i = 0 To Forms.Count - 1
    'If Forms(I).FormName = "MainMenu" Then
    If Forms(i).FormName = Screen.ActiveForm.FormName Then
        Forms(i).Visible = True
    Else
        Forms(i).Visible = False
    End If
Next i

If TurnEchoOn Then DoCmd.Echo True

End Sub

Public Sub PositionReport(theReport)

On Error Resume Next
SetVariable "User " & TheUsername & "_" & "Journal_Report" & "_" & theReport, Str(Date)
DoCmd.ShowToolbar "Form Design", acToolbarNo
DoCmd.ShowToolbar "Report Design", acToolbarNo
DoCmd.ShowToolbar "Print Preview", acToolbarNo
'DoCmd.MoveSize 2 * 1440, 0, 0, 0
DoCmd.Maximize

End Sub




Sub MenuBlack(M, n)

DoCmd.SetMenuItem M - 1, n, , acMenuUngray

End Sub


Sub MenuGray(M, n)

On Error Resume Next
DoCmd.SetMenuItem M - 1, n, , acMenuGray

End Sub

Function Thousandths(TheNumber) As Currency

Thousandths = ConditionNumber(Format(TheNumber, "#.##0"))

End Function

Public Sub StatusBarMessage(TheMessage)

If TheMessage = "" Then TheMessage = " "
On Error Resume Next
If Visio Then
    Forms!Message!TheMessage.Caption = TheMessage
Else
    temp = SysCmd(acSysCmdSetStatus, TheMessage)
End If

End Sub


Public Sub SetLocalVariable(TheName, TheVariable)

On Error GoTo SetLocalVariableError
If NNEN(TheName) = "" Then
    TheName = "Form_" & Screen.ActiveForm.FormName & "_" & Screen.ActiveControl.ControlName
    TheVariable = Screen.ActiveControl
End If
If NNEN(TheVariable) = "" Then TheVariable = Null
GetSettings
LocalSettings.FindFirst " [LocalSettingText5] = '" & TheName & "' "
If LocalSettings.NoMatch Then
    If TheVariable = "DeleteThisVariable" Then GetSettings: Exit Sub
    LocalSettings.MoveFirst
    Do Until LocalSettings.EOF
        If NNEN(LocalSettings!LocalSettingText5) = "" Then LocalSettings.Edit: GoTo CreateNewVariable
        LocalSettings.MoveNext
    Loop
    LocalSettings.AddNew
    GoTo CreateNewVariable
Else
    LocalSettings.Edit
    If TheVariable = "DeleteThisVariable" Then
        TheVariable = ""
        LocalSettings!LocalSettingText5 = Null
        LocalSettings!LocalSettingText6 = Null
        LocalSettings.Update
        ErrorLogEntry "Deleted local variable " & LocalSettings!Key & " " & TheName
    Else
        LocalSettings!LocalSettingText6 = TheVariable
        If LocalSettings!LocalSettingText5 = "Form_Resources_ResourceList" Then
        ElseIf InStr(LocalSettings!LocalSettingText5, "Form_Resources_ResourceList") <> 0 Then
            Dim myset As DAO.Recordset
            Set myset = mydb.OpenRecordset("Select ID from [>Resources] where key = " & Val(TheVariable), dbOpenDynaset, dbSeeChanges)
            If myset.RecordCount <> 0 Then
                LocalSettings!LocalSettingText7 = myset!ID
            End If
        End If
        LocalSettings.Update
    End If
End If
GetSettings
Exit Sub

CreateNewVariable:
LocalSettings!LocalSettingText5 = TheName
LocalSettings!LocalSettingText6 = TheVariable
LocalSettings.Update
ErrorLogEntry "Created new local variable " & TheName
GetSettings
Exit Sub

SetLocalVariableError:
    'MsgBox Err.Description
Resume ResumeSetLocalVariableError
ResumeSetLocalVariableError:


End Sub

Public Function SetMonitor(TheSize)

'Form_Synchronization.UpdateProjectSchedule
'Exit Function
SetLocalVariable "FormMainMenu_ScreenSize", TheSize
If TheSize = 0 Then
    DoCmd.RunCommand acCmdAppMaximize
Else
    DoCmd.RunCommand acCmdAppRestore
End If
PositionForm
'Forms!MainMenu.Requery

End Function

Function ResponseYes(TheMessage)

If MsgBox(TheMessage, 36, "") = 6 Then ResponseYes = True

End Function

Public Function Password(TheString)

g_Password = TheString
DoCmd.OpenForm "Password"
While g_Password = TheString
    DoEvents
Wend
DoCmd.Close acForm, "Password"
If g_Password = "True" Then
    TheMessage = ""
    Password = True
Else
    MsgBox "Password is incorrect.", 64, "Password"
    TheMessage = " Unsuccessful"
End If
SetVariable "User " & TheUsername & "_" & g_ThisForm & "_" & Forms(Forms.Count - 1).FormName, Str(Date) & TheMessage

End Function

Public Function ResourcePassword(TheString)

g_Password = TheString
DoCmd.OpenForm "ResourcePassword"
While g_Password = TheString
    DoEvents
Wend
DoCmd.Close acForm, "ResourcePassword"
If g_Password = "True" Then
    TheMessage = ""
    ResourcePassword = True
Else
    MsgBox "Password is incorrect.", 64, "Password"
    TheMessage = " Unsuccessful"
End If
SetVariable "User " & TheUsername & "_" & g_ThisForm & "_" & Forms(Forms.Count - 1).FormName, Str(Date) & TheMessage

End Function

Public Function NNEZ(TheNumber) As Double

On Error Resume Next
If IsNull(TheNumber) Or TheNumber = "" Then NNEZ = 0 Else NNEZ = TheNumber


End Function

Public Function NNEN(TheString)

On Error Resume Next
If IsNull(TheString) Then NNEN = "" Else NNEN = TheString


End Function

Public Function IncomeStatementSetup()

If InStr(Forms!GeneralLedger!FromDate, "1/1") = 0 Then
    Reports![General Ledger KR+H Detail Income Statement].Width = 10 * 1440
    Reports![General Ledger KR+H Detail Income Statement].Printer.Orientation = acPRORLandscape
    DoCmd.Close acReport, "General Ledger KR+H Detail Income Statement", acSaveYes
Else
    Reports![General Ledger KR+H Detail Income Statement].Width = 8 * 1440
    Reports![General Ledger KR+H Detail Income Statement].Printer.Orientation = acPRORPortrait
    DoCmd.Close acReport, "General Ledger KR+H Detail Income Statement", acSaveYes
End If


End Function

Function MessageOKCancel(TheMessage)

'returns True when no is selected
'returns false when yes is selected
MessageOKCancel = False
Response = MsgBox(TheMessage, 36, " ")
If Response = 7 Then ' cancel
    MessageOKCancel = True
    RecalculateListInProgress = False
End If

End Function


Function MessageOK(TheMessage)

MsgBox TheMessage, 64, "Message"

End Function

Function MessageYesNoCancel(TheMessage) As String

Response = MsgBox(TheMessage, 35, " ")
If Response = vbNo Then
    MessageYesNoCancel = "No"
    RecalculateListInProgress = False
ElseIf Response = vbYes Then
    MessageYesNoCancel = "Yes"
    RecalculateListInProgress = False
Else
    MessageYesNoCancel = "Cancel"
    RecalculateListInProgress = False
End If

End Function
Function LowerCase(TheString)

TheString = LCase(TheString)

End Function

Function Hundredths(TheNumber)

Hundredths = ConditionNumber(Format(NNEZ(TheNumber), "#.#0"))

End Function


Function RoundDown(TheNumber)

RoundDown = ConditionNumber(Format(TheNumber, "#."))

End Function

Function FIsActiveForm(stFrmName$) As Integer

FIsActiveForm = False
On Error GoTo FIsActiveFormError
'If LastForm = stFrmName$ And FIsLoaded(stFrmName$) Then FIsActiveForm = True
If Screen.ActiveControl.ControlName = "Key" Then FIsActiveForm = False
If Screen.ActiveForm.FormName = stFrmName$ Then
    FIsActiveForm = True
End If
Exit Function
FIsActiveFormError:
Resume ResumeFIsActiveFormError
ResumeFIsActiveFormError:

End Function


'----------------------------------------------------------------------------
' FUNCTION : FIsLoaded
'
' PURPOSE  : Returns true if a the given Form/Report is currently open.
'----------------------------------------------------------------------------
Function FIsLoaded(stFrmName$) As Integer

' Scan the open forms...
FIsLoaded = False

    For i = 0 To Forms.Count - 1
        If (Forms(i).FormName = stFrmName$) Then
            FIsLoaded = True
            Exit Function
        End If
    Next i

    ' Scan the open reports...

    For i = 0 To Reports.Count - 1
        If (Reports(i).FormName = stFrmName$) Then
            FIsLoaded = True
            Exit Function
        End If
    Next i

    FIsLoaded = False
If g_FormParts_Parts And stFrmName$ = "Parts" Then
    FIsLoaded = True
ElseIf g_FormParts_DrawingParts And stFrmName$ = "PartsDraw" Then
    FIsLoaded = True
ElseIf g_FormParts_CNCParts And stFrmName$ = "PartsCNC" Then
    FIsLoaded = True
Else
    If g_FormProductParts_DrawingPartsControl And g_FormParts_DrawingParts And stFrmName$ = "PartsDraw" Then
        FIsLoaded = True
    ElseIf g_FormProductParts_CNCPartsControl And g_FormParts_CNCParts And stFrmName$ = "PartsCNC" Then
        FIsLoaded = True
    End If
End If

End Function

Sub ErrorLogReport(TheNumber)

On Error Resume Next
Dim ErrorSet As DAO.Recordset
SetMyDB
Set ErrorSet = mydb.OpenRecordset("SELECT* from [>Errors] Where Not IsNull([Error])", dbOpenDynaset, dbSeeChanges)
If ErrorSet.RecordCount <> 0 Then
    ErrorSet.MoveLast
    If ErrorSet.RecordCount >= TheNumber Then
        Beep
        If ErrorSet.RecordCount = 1 Then
            StatusBarMessage "There is 1 log entry. See the log for details."
        Else
            StatusBarMessage "There are " & ErrorSet.RecordCount & " log entries. See the log for details."
        End If
        ErrorLogEntry "Total entries: " & ErrorSet.RecordCount
        Finish = Timer + 3
        Do
        Loop Until Timer > Finish
    End If
End If

End Sub

Sub ErrorLogEntry(TheError)

On Error GoTo ErrorLogEntryError
While g_ElapsedTimer = Now: Wend
g_ElapsedTimer = Now
Dim ErrorSet As DAO.Recordset
SetMyDB
Set ErrorSet = mydb.OpenRecordset("SELECT* from [>Errors] Where [Error] = Null Order by [Key]", dbOpenDynaset, dbSeeChanges)
If ErrorSet.RecordCount = 0 Then ErrorSet.AddNew Else ErrorSet.MoveFirst: ErrorSet.Edit
ErrorSet!Error = TheError
ErrorSet!Time = Now
ErrorSet.Update
TheActiveForm = Screen.ActiveForm.Caption
'ErrorSet.Edit
'ErrorSet!Form = TheActiveForm
'ErrorSet.Update
If FIsLoaded("Log") Then
    DoCmd.SelectObject acForm, "Log"
    Forms!Log.Requery
    Forms!Log.Refresh
End If

Exit Sub

ErrorLogEntryError:
Resume ResumeErrorLogEntryError
ResumeErrorLogEntryError:

End Sub


Sub ErrorLogClear()

On Error GoTo ErrorLogClearError
SetMyDB
Set ErrorSet = mydb.OpenRecordset("SELECT* from [>Errors]", dbOpenDynaset, dbSeeChanges)
If ErrorSet.RecordCount <> 0 Then
    ErrorSet.MoveFirst
    Do Until ErrorSet.EOF
        TheRecordNumber = TheRecordNumber + 1
        If TheRecordNumber > 200 Then
            ErrorSet.Delete
        ElseIf NNEN(ErrorSet!Error) <> "" Or NNEN(ErrorSet!Time) <> "" Or NNEN(ErrorSet!Form) <> "" Then
            ErrorSet.Edit
            ErrorSet!Error = Null
            ErrorSet!Form = Null
            ErrorSet!Time = Null
            ErrorSet.Update
        End If
        ErrorSet.MoveNext
    Loop
End If
'Exit Sub
 
ErrorLogClearError:

End Sub

Function TenThousandths(TheNumber)

TenThousandths = ConditionNumber(Format(TheNumber, "#.###0"))

End Function


Public Function NNENull(TheString)

If NNEN(TheString) = "" Then NNENull = Null Else NNENull = TheString

End Function

Public Function ResourceAddressPhone(String1, String2, String3, String4, String5, String6)

On Error Resume Next
theaddress = ResourceAddress(String1, String2, String3, String4)
If NNEN(String5) <> "" Or NNEN(String6) <> "" Then
    theaddress = theaddress & Chr$(13) & Chr$(10) & String5 & " " & String6
End If
ResourceAddressPhone = theaddress

End Function

Public Function ResourcePhone(String4, String5)

On Error Resume Next
If NNEN(String4) <> "" Or NNEN(String5) <> "" Then
    theaddress = String4 & " " & String5
End If
ResourcePhone = theaddress

End Function

Public Function ResourceAddress(String1, String2, String3, String4)

On Error Resume Next
If NNEN(String1) <> "" Then String1 = String1 & CRLF
If Right(String2, 1) <> "," Then String2 = String2 & ","
ResourceAddress = String1 & String2 & "    " & String3 & "   " & String4

End Function

Public Function ResourcePhone1(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
    If NNEN(myset!Field2) <> "" Then
        firstchar = False
        lastChar = False
        For i = 1 To Len(myset!Field2)
            thischar = Mid(myset!Field2, i, 1)
            If thischar = "1" Then
                firstchar = True
            ElseIf thischar = "2" Then
                firstchar = True
            ElseIf thischar = "3" Then
                firstchar = True
            ElseIf thischar = "4" Then
                firstchar = True
            ElseIf thischar = "5" Then
                firstchar = True
            ElseIf thischar = "6" Then
                firstchar = True
            ElseIf thischar = "7" Then
                firstchar = True
            ElseIf thischar = "8" Then
                firstchar = True
            ElseIf thischar = "9" Then
                firstchar = True
            ElseIf thischar = "0" Then
                firstchar = True
            ElseIf thischar = "-" Then
            ElseIf thischar = "." Then
                thischar = "-"
            ElseIf thischar = "/" Then
                thischar = "-"
            ElseIf thischar = " " Then
                thischar = "-"
            ElseIf thischar = "(" Then
                thischar = ""
            ElseIf thischar = ")" Then
                thischar = ""
            Else
                If firstchar Then lastChar = True
            End If
            If lastChar Then Exit For
            If firstchar Then thephone = thephone & thischar
        Next i
    End If
    Do Until Right(thephone, 1) <> "-"
        thephone = Left(thephone, Len(thephone) - 1)
    Loop
    'If Not lastCharNumber Then
        'thephone = Left(thephone, Len(thephone) - 1)
    'End If
    ResourcePhone1 = Left(thephone, 14)
    
End Function

Public Function ResourceAddress1(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
    If NNEN(myset!Address) <> "" Then
        For i = 1 To Len(myset!Address)
            If Mid(myset!Address, i, 1) = Chr$(10) Then Exit For
            If Mid(myset!Address, i, 1) = Chr$(13) Then Exit For
            theaddress = theaddress & Mid(myset!Address, i, 1)
        Next i
    End If
    If ResourceTown(TheKey) <> theaddress Then ResourceAddress1 = theaddress
    
End Function

Public Function ResourceEmail(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
    If NNEN(myset!Field4) <> "" Then
        For i = 1 To Len(myset!Field4)
            If Mid(myset!Field4, i, 1) = Chr$(10) Then Exit For
            If Mid(myset!Field4, i, 1) = Chr$(13) Then Exit For
            theData = theData & Mid(myset!Field4, i, 1)
        Next i
    End If
    ResourceEmail = Left(theData, 40)
    
End Function

Public Function ResourceComment1(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
    If NNEN(myset!Field1) <> "" Then
        For i = 1 To Len(myset!Field1)
            If Mid(myset!Field1, i, 1) = Chr$(10) Then Exit For
            If Mid(myset!Field1, i, 1) = Chr$(13) Then Exit For
            theData = theData & Mid(myset!Field1, i, 1)
        Next i
    End If
    ResourceComment1 = Left(theData, 30)
    
End Function

Public Function ResourceComment2(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
foundComment2 = False
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
    If NNEN(myset!Field1) <> "" Then
        For i = 1 To Len(myset!Field1)
            If Mid(myset!Field1, i, 1) = Chr$(10) Then
                If foundComment2 Then Exit For
                foundComment2 = True
            ElseIf Mid(myset!Field1, i, 1) = Chr$(13) Then
            Else
                If foundComment2 Then theData = theData & Mid(myset!Field1, i, 1)
            End If
        Next i
    End If
    ResourceComment2 = Left(theData, 30)
    
End Function

Public Function ResourceAddress2(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
foundAddress2 = False
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
    If NNEN(myset!Address) <> "" Then
        For i = 1 To Len(myset!Address)
            If Mid(myset!Address, i, 1) = Chr$(10) Then
                If foundAddress2 Then Exit For
                foundAddress2 = True
            ElseIf Mid(myset!Address, i, 1) = Chr$(13) Then
            Else
                If foundAddress2 Then theaddress = theaddress & Mid(myset!Address, i, 1)
            End If
        Next i
    End If
    If ResourceTown(TheKey) <> theaddress Then ResourceAddress2 = theaddress
    
End Function

Public Function ResourceTown(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If NNEN(myset!Address) <> "" Then
        For i = 1 To Len(myset!Address)
            theaddress = theaddress & Mid(myset!Address, i, 1)
            If Mid(myset!Address, i, 1) = Chr$(10) Then theaddress = ""
            If Mid(myset!Address, i, 1) = Chr$(13) Then theaddress = ""
        Next i
    End If
    ResourceTown = theaddress
End If

End Function

Public Function ResourceStreet1(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If NNEN(myset!Address) <> "" Then
        For i = 1 To Len(myset!Address)
            If Mid(myset!Address, i, 1) = Chr$(10) Then Exit For
            If Mid(myset!Address, i, 1) = Chr$(13) Then Exit For
            theaddress = theaddress & Mid(myset!Address, i, 1)
        Next i
    End If
    ResourceStreet1 = theaddress
End If

End Function

Public Function NoDashes(TheString)

For i = 1 To Len(NNEN(TheString))
    If Mid(TheString, i, 1) <> "-" Then TheResult = TheResult & Mid(TheString, i, 1)
Next i
NoDashes = NNEN(TheResult)

End Function

Public Function ResourceID(TheLine)

On Error Resume Next
M = InStr(TheLine, "(")
If M <> 0 Then
    n = InStr(M, TheLine, ")")
    If n <> 0 Then
        If M <> 1 Then Variant9 = Left(TheLine, M - 1) Else Variant9 = ""
        If n <> Len(TheLine) Then Variant1 = Right(TheLine, Len(TheLine) - n) Else Variant1 = ""
        TheLine = Variant9 & Variant1
    End If
End If
ResourceID = TheLine

End Function

Public Function ResourceFirstID(TheLine)

On Error Resume Next
M = InStr(TheLine, "(")
If M <> 0 Then
    n = InStr(M, TheLine, ")")
    If n <> 0 Then
        If M <> 1 Then Variant9 = Left(TheLine, M - 1) Else Variant9 = ""
        If n <> Len(TheLine) Then Variant1 = Right(TheLine, Len(TheLine) - n) Else Variant1 = ""
        TheLine = Variant9 & Variant1
    End If
End If
If InStr(TheLine, Chr$(13)) <> 0 Then TheLine = Left(TheLine, InStr(TheLine, Chr$(13)) - 1)
ResourceFirstID = TheLine

End Function

Public Function Resource(TheKey As Long)

Resource = NNEN(SQLResult("Select ID from [>Resources] where key =" & TheKey))

End Function

Public Function GetBalance(TheDate As Date, TheAccount)

SetMyDB
Dim AccountDate As Date

Dim accounts As DAO.Recordset
Set accounts = mydb.OpenRecordset("Select * from [MIS Accounts] where number<>0 Order by FY9 desc", dbOpenSnapshot, dbSeeChanges)
AccountDate = "1/1/" & accounts!FY9
Dim theFY As Date
theFY = accounts!FY9
If Year(TheDate) = Year(AccountDate) Then
    Set accounts = mydb.OpenRecordset("Select * from [MIS Accounts] where number = " & TheAccount, dbOpenDynaset, dbSeeChanges)
    GetBalance = accounts!Balance
    If NNEZ(accounts!FY9) = 0 Then
        accounts.Edit
        accounts!FY9 = theFY
        accounts.Update
    End If
    g_BeginDate = "1/1/" & accounts!FY9
ElseIf Year(TheDate) = Year(AccountDate) - 1 Then
    Set accounts = mydb.OpenRecordset("Select * from [MIS Accounts] where number = " & TheAccount, dbOpenSnapshot, dbSeeChanges)
    GetBalance = accounts!FY5
    g_BeginDate = "1/1/" & NNEZ(accounts!FY9) - 1
Else
    GetBalance = 0: Exit Function
End If
g_EndDate = Forms!GeneralLedger!FromDate
g_EndDate = g_EndDate - 1
Set accounts = mydb.OpenRecordset("Select * from [General Ledger] where AccountNumber =" & TheAccount & " and TransactionDate >=#" & g_BeginDate & "# and TransactionDate <= #" & g_EndDate & "#", dbOpenSnapshot, dbSeeChanges)
If accounts.RecordCount <> 0 Then
    Do Until accounts.EOF
        GetBalance = GetBalance - NNEZ(accounts!CreditAmount) + NNEZ(accounts!DebitAmount)
        accounts.MoveNext
    Loop
End If



End Function




Sub SetMenu()

On Error GoTo Error
If IsNull(LastForm) Then LastForm = "MainMenu" Else LastForm = ThisForm
ThisForm = Screen.ActiveForm.FormName
If Screen.ActiveForm.FormName = "ProductListMaster" Then
    Forms!ProductListMaster!ProductListControl!PasteButton.Enabled = False
ElseIf Screen.ActiveForm.FormName = "MainMenu" Then
    If NNEN(LocalVariable("AppSize")) = "" Or LocalVariable("AppSize") = "Sizeable" Then
        DoCmd.RunCommand acCmdAppRestore
    Else
        DoCmd.RunCommand acCmdAppMaximize
    End If
    Else
    MenuGray 1, 5 'blurr Paste Record
End If

Exit Sub

Error:
Resume resumeerror
resumeerror:

End Sub

Function CancelFile()

On Error Resume Next
DoCmd.Close A_FORM, Screen.ActiveForm.FormName
'If Screen.ActiveForm.FormName = "ProductListMaster" Then RequeryPopups

End Function

Function FormatWholeNumber(TheValue)

FormatWholeNumber = Format(NNEZ(TheValue), "###,##0;-###,##0")

End Function

Public Function ProductName(TheProductName)

If NNEZ(TheProductName) <> 0 And NNEZ(TheProductName) = NNEZ(g_Product) Then
    ProductName = g_ProductName
    'ErrorLogEntry "Repeated " & g_ProductName
Else
    Dim ProductsSet As DAO.Recordset
    SetMyDB
    Set ProductsSet = mydb.OpenRecordset("SELECT [ID]  from [>Products] WHERE [Key] = " & NNEZ(TheProductName) & " ", dbOpenDynaset, dbSeeChanges)
    If ProductsSet.RecordCount = 0 Then
        ProductName = ""
        g_Product = 0
        g_ProductName = ""
    Else
        ProductName = ProductsSet!ID
        'ErrorLogEntry ProductsSet!ID
        g_Product = TheProductName
        g_ProductName = ProductsSet!ID
    End If
End If

End Function

Public Function JobFormOpen()


On Error Resume Next
g_JobForm = Screen.ActiveForm.Name & " Job"
DoCmd.OpenForm "Job"
Forms!Job!JobName.Enabled = True


End Function

Public Function JobOpen()

On Error Resume Next
FoundJob = 0
Dim frm As Form, ctl As Control
If Screen.ActiveForm.Name = "ProductListMaster" Then
    Set frm = Forms!ProductListMaster!ProductListControl.Form
Else
    Set frm = Screen.ActiveForm
End If
For Each ctl In frm.Controls
    If InStr(ControlType(ctl.ControlType), "list box") <> 0 Then
        'ErrorLogEntry "Found in Form" & ControlType(ctl.ControlType) & " " & ctl.Name
        If InStr(ctl.Name, "Job") <> 0 Then
            If NNEN(ctl.ControlSource) = "" Then UnBound = ctl.Value
            SetLocalVariable "FormJobs_JobName", ctl.Value
            FoundJob = FoundJob + 1
        End If
    End If
Next
If FoundJob = 0 Then
    MsgBox "A combo box that includes the name Job was not found to initialize the name of the Job on the Job Form"
ElseIf FoundJob > 1 Then
    If NNEN(UnBound) <> "" Then
        SetLocalVariable "FormJobs_JobName", UnBound
    End If
End If
DoCmd.OpenForm "Job"

End Function

Public Function FindOpen()

On Error GoTo FindError
Screen.PreviousControl.SetFocus
TheFormName = Left(Screen.ActiveForm.Name, 1)
DoCmd.RunCommand (acCmdFind)
SendKeys "%h" '& "a", True
SendKeys "a"
SendKeys "%l"
SendKeys "{Down}"
SendKeys "%n"
'DoCmd.DoMenuItem acFormBar, acEditMenu, 10, , acMenuVer70
'SendKeys "%ha", True
'SendKeys "%ra", True
'SendKeys "%e", True
'SendKeys "%n{Delete}", True
Exit Function

FindError:
MsgBox Err.Description
Resume ResumeFindError
ResumeFindError:

End Function

Public Function CalcControl(ThePlaces, TheLine)

If Left(TheLine, 1) = "=" Then
      CalcControl = CalcString(ThePlaces, Right(TheLine, Len(TheLine) - 1))
Else
      CalcControl = TheLine
End If

End Function

Public Function Help()

If LocalVariable("Form_MainMenu_Password") = "KRH" Then HelpUpdate
TheForm = Screen.ActiveForm.Caption
TheControl = NNEN(Screen.ActiveControl.ControlName)
TheStatusBarText = NNEN(Screen.ActiveControl.StatusBarText)
TheTag = NNEN(Screen.ActiveControl.Tag)
SetMyDB
Dim myset As DAO.Recordset, mytable As DAO.Recordset
EchoOff

On Error Resume Next
Set myset = mydb.OpenRecordset("Select * from [>Help] Where [Form] = '" & TheForm & "' Order by [Category], [Label] ", dbOpenDynaset, dbSeeChanges)
DoCmd.OpenForm "Help"
Forms!Help!HelpForm = TheForm
Forms!Help!Message = TheStatusBar
If InStr(TheTag, "Help for all notes") <> 0 Then
    Forms!Help!HelpEdit.Visible = False
    Set mytable = Forms!ProductListMaster!ProductListControl.Form.RecordsetClone
    If mytable.RecordCount <> 0 Then
        mytable.MoveFirst
        Do Until mytable.EOF
            Set myset = mydb.OpenRecordset("Select * from [>Note] Where [ProductListKey] = " & mytable!Key, dbOpenDynaset, dbSeeChanges)
            If myset.RecordCount <> 0 Then
                myset.MoveFirst
                GuideText = GuideText & "Item " & mytable!Item & Chr$(13) & Chr$(10)
                Do Until myset.EOF
                    GuideText = GuideText & "Re: " & myset!ID & Chr$(13) & Chr$(10)
                    GuideText = GuideText & myset!Note & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10)
                    myset.MoveNext
                Loop
            End If
            mytable.MoveNext
        Loop
    End If
Else
    If myset.RecordCount <> 0 Then
        GuideText = ""
        If InStr(TheTag, "selected option") Then TheTag = Form_Options!OptionSelection
        If InStr(TheTag, "all options") Then TheTag = Form_Options!OptionsList
        myset.FindFirst "[Control] = '" & TheControl & "' "
        FirstRecord = True
        If myset.NoMatch Then
        Else
            TheCategory = NNEN(myset!Category)
            TheStatusBar = myset!Label
            Forms!Help!Message = myset!Label
            If TheTag <> "" Then GuideText = "Note: " & TheTag & Chr$(13) & Chr$(10)
            GoSub GetData
            FirstRecord = False
        End If
        myset.MoveFirst
        Do Until myset.EOF
            If myset!Control <> TheControl Then GoSub GetData
            myset.MoveNext
        Loop
    End If
End If
Forms!Help!HelpText = Left(GuideText, 64000)
EchoOn
Exit Function

GetData:
    'StatusBarMessage "Getting data for " & MySet!Label
    SkipThis = True
    TheGuideText = ""
    If NNEN(myset!Category) <> "" Then TheGuideText = TheGuideText & myset!Category & ": "
    If NNEN(myset!Label) <> "" Then TheGuideText = TheGuideText & myset!Label
    If Not IsNull(myset!Purpose) Then SkipThis = False: TheGuideText = TheGuideText & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10) & "Purpose: " & myset!Purpose
    If Not IsNull(myset!Description) Then SkipThis = False: TheGuideText = TheGuideText & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10) & "Description: " & myset!Description
    If Not IsNull(myset!Examples) Then SkipThis = False: TheGuideText = TheGuideText & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10) & "Example: " & myset!Examples
    If Not IsNull(myset!Limitations) Then SkipThis = False: TheGuideText = TheGuideText & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10) & "Limitations: " & myset!Limitations
    If Not IsNull(myset!SeeAlso) Then SkipThis = False: TheGuideText = TheGuideText & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10) & "See also: " & myset!SeeAlso
    If Not IsNull(myset!References) Then SkipThis = False: TheGuideText = TheGuideText & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10) & "References: " & myset!References
    If SkipThis And FirstRecord Then GuideText = GuideText & "No specific help for the currently selected " & myset!Category & "." & Chr$(13) & Chr$(10)
    If Not SkipThis Then
        If GuideText <> "" Then
            GuideText = GuideText & Chr$(13) & Chr$(10)
            GuideText = GuideText & Chr$(13) & Chr$(10)
            GuideText = GuideText & "______________________________________________________________________"
            GuideText = GuideText & Chr$(13) & Chr$(10)
            GuideText = GuideText & Chr$(13) & Chr$(10)
        End If
        'If Len(TheGuideText) > 256 Then ErrorLogEntry TheGuideText
        GuideText = GuideText & TheGuideText
    End If
Return

End Function

Private Function ControlType(TheControl)

'If TheControl = 101 Then
    'ControlType = "Rectangle"
'ElseIf TheControl = 102 Then
    'ControlType = "Line"
'ElseIf TheControl = 103 Then
    'ControlType = "Image"
If TheControl = 104 Then
    ControlType = "Button"
ElseIf TheControl = 105 Then
    ControlType = "Option button"
ElseIf TheControl = 106 Then
    ControlType = "Check box"
'ElseIf TheControl = 107 Then
    'ControlType = "Option group"
ElseIf TheControl = 108 Then
    ControlType = "Bound object frame"
ElseIf TheControl = 109 Then
    ControlType = "Text box"
ElseIf TheControl = 110 Then
    ControlType = "List box"
ElseIf TheControl = 111 Then
    ControlType = "List box"
ElseIf TheControl = 112 Then
    ControlType = "Subform"
'ElseIf TheControl = 114 Then
    'ControlType = "Unbound object frame"
'ElseIf TheControl = 118 Then
    'ControlType = "Page break"
'ElseIf TheControl = 119 Then
    'ControlType = "Custom control"
ElseIf TheControl = 122 Then
    ControlType = "Toggle button"
Else
    ControlType = "?"
End If

End Function

Public Sub DetermineRevision()

If g_ThisForm = "KRH" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_KRHRev"))
ElseIf g_ThisForm = "KRHEdit" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_KRHEditRev"))
ElseIf g_ThisForm = "Journals" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_JournalsRev"))
ElseIf g_ThisForm = "FinancialReports" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_FinancialReportsRev"))
ElseIf g_ThisForm = "AccountingReports" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_AccountingReportsRev"))
ElseIf g_ThisForm = "ProjectManagerReports" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_ProjectManagerReportsRev"))
ElseIf g_ThisForm = "Schedule" Then
    g_CurrentRev = NNEZ(LocalVariable("Form_Synchronization_ScheduleRev"))
End If

End Sub

Public Function BillsApp()

If g_ThisForm = "KRH" Then
    BillsApp = True
ElseIf g_ThisForm = "KRHEdit" Then
    BillsApp = True
ElseIf g_ThisForm = "Journals" Then
    BillsApp = True
ElseIf g_ThisForm = "FinancialReports" Then
    CurrentRev = LocalVariable("Form_Synchronization_FinancialReportsRev")
ElseIf g_ThisForm = "AccountingReports" Then
    g_CurrentRev = LocalVariable("Form_Synchronization_AccountingReportsRev")
ElseIf g_ThisForm = "ProjectManagerReports" Then
    g_CurrentRev = LocalVariable("Form_Synchronization_ProjectManagerReportsRev")
ElseIf g_ThisForm = "Schedule" Then
    g_CurrentRev = LocalVariable("Form_Synchronization_ScheduleRev")
End If

End Function

Public Sub DetermineApplication()

Set mydb = CurrentDb()
g_APPName = mydb.Name
theDot = InStr(Application.CurrentProject.Name, ".")
g_TheAppName = Left(Application.CurrentProject.Name, theDot - 1)

For i = 0 To Forms.Count - 1
    If InStr(mydb.Name, "krh.mdb") <> 0 Then
        TheSteps = 4
        g_ThisForm = "KRH"
    ElseIf InStr(mydb.Name, "krhedit.mdb") Then
        TheSteps = 1
        g_ThisForm = "KRHEdit"
    ElseIf InStr(mydb.Name, "journal") Then
        TheSteps = 2
        g_ThisForm = "Journals"
    ElseIf InStr(mydb.Name, "accountingreports.mdb") Then
        TheSteps = 6
        g_ThisForm = "AccountingReports"
    ElseIf InStr(mydb.Name, "Management") Or InStr(mydb.Name, "Schedule") Then
        TheSteps = 7
        g_ThisForm = "ManagementReports"
    End If
Next i
'8 is Visio rev!!
g_ApplicationNumber = TheSteps

End Sub
Public Function ConditionName(TheName)

For i = 1 To Len(TheName)
    If Mid(TheName, i, 1) = ":" Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = "/" Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = "\" Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = "&" Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = "," Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = "." Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = "'" Then Mid(TheName, i, 1) = "_"
    If Mid(TheName, i, 1) = Chr$(34) Then Mid(TheName, 1, 1) = "_"
Next i
ConditionName = TheName

End Function

Public Function ConnectedToServer()

On Error GoTo Error
GetSettings
g_RemoteConnection = True
KRH_NetworkAddress = Variable("KRH_NetworkAddress")
If NNEN(KRH_NetworkAddress) = "" Then KRH_NetworkAddress = "192.168.115"
ErrorLogEntry "KRH network address " & KRH_NetworkAddress
TheIPAddress = GetIPAddress
If NNEZ(TheIPAddress) = 0 Then
    ErrorLogEntry "Local IP address not found"
End If
If InStr(TheIPAddress, KRH_NetworkAddress) <> 0 Then
    g_RemoteConnection = False
End If
ErrorLogEntry "Local IP address " & TheIPAddress
If Not g_RemoteConnection Or g_ConnectRemotely Then
    EchoOff
    TheTime = Timer
    Dim dbs As Database
    Set dbs = CurrentDb()
    TheDatabase = "APCSet.mdb"
    NetworkPath = LocalVariable("Form_Synchronization_NetworkPath")
    StatusBarMessage "Connecting to Server"
    Set dbs = DBEngine(0).OpenDatabase(NetworkPath & TheDatabase)
    g_ServerConnection = Hundredths(Timer - TheTime)
    ConnectedToServer = g_ServerConnection
    ErrorLogEntry "Connected to server in " & g_ServerConnection & " seconds."
    EchoOn
    If Not g_RemoteConnection Then ErrorLogEntry "Auto-sync enabled"
Else
    If Not g_RemoteConnection Then ErrorLogEntry "Auto-sync disabled"
End If
StatusBarMessage " "

Exit Function

Error:
    MsgBox Err.Description
    StatusBarMessage "Connection to server not established"
    'SetLocalVariable "Server_Online", ""
    g_ServerConnection = 0
    ConnectedToServer = 0
    ErrorLogEntry "Auto-sync disabled"
    EchoOn
Resume resumeerror
resumeerror:

End Function



Public Sub MainMenuLoad()

On Error GoTo MainMenuLoadError
GetSettings
DetermineApplication
If InStr(g_ThisForm, "Project") <> 0 Or InStr(g_ThisForm, "Journal") <> 0 Then
    Dim mytable As TableDef, Charts As DAO.Recordset
    FoundTable = False
    For i = 0 To mydb.TableDefs.Count - 1
        If mydb.TableDefs(i).Name = "Charts" Then FoundTable = True
    Next i
    If Not FoundTable Then
        Set mytable = mydb.CreateTableDef("Charts")
        With mytable
        .Fields.Append .CreateField("Counter", dbLong)
        .Fields.Append .CreateField("Value1", dbCurrency)
        .Fields.Append .CreateField("Value2", dbCurrency)
        .Fields.Append .CreateField("Date1", dbDate)
        .Fields.Append .CreateField("Date2", dbDate)
        .Fields.Append .CreateField("Text1", dbText)
        .Fields.Append .CreateField("Text2", dbText)
        End With
        mydb.TableDefs.Append mytable
    End If
End If
If InStr(g_ThisForm, "KRH") <> 0 Then
    CreateLocalTables
    GetSettings
    'get Visio revision
    For i = 1 To 8
        Settings.MoveNext
    Next i
    Forms!Mainmenu!VisioCopyRight = Settings!CopyRight
    For i = 1 To 4
        Settings.MovePrevious
    Next i
End If
TheMessage = ""
StartLoading:
Dim dbs As Database
Set dbs = CurrentDb()
'For i = 0 To dbs.Properties.Count - 1
    'MsgBox dbs.Properties(i).Name
    'If InStr(dbs.Properties(i).Name, "StartupShowDBWindow") <> 0 Then
        'dbs.Properties(i) = False
    'ElseIf InStr(dbs.Properties(i).Name, "StartUptoolbars") <> 0 Then
        'dbs.Properties(i) = False
    'ElseIf InStr(dbs.Properties(i).Name, "Allow") <> 0 Then
        'dbs.Properties(i) = True
    'End If
'Next i
DBEngine.SetOption dbMaxLocksPerFile, 445000
Application.SetOption "Left Margin", 0.25
Application.SetOption "Right Margin", 0.25
Application.SetOption "Top Margin", 0.75
Application.SetOption "Bottom Margin", 0.25
Application.SetOption "Default Database Directory", "C:\Access"
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset(">CopyRight", dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    GetSettings
    LocalSettingsLastPath "Get"
    DetermineApplication
    DetermineRevision
    For i = 1 To g_ApplicationNumber
        Settings.MoveNext
    Next i
    Forms!Mainmenu!CopyRight = myset!CopyRight
    If DateDiff("d", Settings!CopyRight, myset!CopyRight) < 0 Then
        'ServerConnection = ConnectedToServer
        'If g_ServerConnection <> 0 Then
        If g_RemoteConnection Then
            If MessageOKCancel("There is an update to " & g_ThisForm & " available. Would you like to update now?") Then
                Exit Sub
            Else
                g_ConnectRemotely = True
                If ConnectedToServer = 0 Then
                    g_ConnectRemotely = False
                    MsgBox "A connection to the server could not be established"
                    Exit Sub
                End If
            End If
        End If
        If g_ServerConnection <> 0 Then
            TheMessage = "An error occurred while synchronizing " & g_ThisForm & " application. " & Err.Description
            EchoOn
            LocalDatabase = "C:\Access\"
            TheDatabase = g_ThisForm & ".mdb"
            NetworkPath = ServerPath & "\Access\Access 2000\"
            StatusBarMessage "Receiving changes into " & TheDatabase
            ThisDatabase = g_ThisForm & ".mdb"
            Set dbs = DBEngine(0).OpenDatabase(LocalDatabase & ThisDatabase)
            dbs.Synchronize NetworkPath & TheDatabase, dbRepImportChanges
            StatusBarMessage ""
            EchoOn
            SetVariable "User " & TheUsername & "_Synchronized_" & g_ThisForm, Str(Date)
            If InStr(TheUsername, "Time") <> 0 And InStr(TheUsername, "Card") <> 0 Then
            Else
                MsgBox "Synchronization was successful." & Chr$(13) & Chr$(13) & "Your application has been updated and will be re-opened"
            End If
            RestartApplication
        End If
    End If
    If g_CurrentRev = "" Then g_CurrentRev = Date - 100
    If DateDiff("d", myset!CopyRight, g_CurrentRev) <> 0 Then
        If NNEN(myset!Message) <> "" Then
            If InStr(TheUsername, "Time") <> 0 And InStr(TheUsername, "Card") <> 0 Then
            Else
                MsgBox myset!Message
            End If
            SetLocalVariable "Form_Synchronization_" & g_ThisForm & "Rev", Forms!Mainmenu!CopyRight
        End If
    End If
End If

Exit Sub

MainMenuLoadError:
EchoOn
If InStr(TheUsername, "Time") <> 0 And InStr(TheUsername, "Card") <> 0 Then
Else
    MsgBox TheMessage & Err.Description
End If
Resume ResumeMainMenuLoadError
ResumeMainMenuLoadError:
SetLocalVariable "Form_Synchronization_" & ThisForm, Date - 100
End Sub

Public Function RequeryControl()

Screen.ActiveControl.Requery

End Function

Public Function HelpUpdate()

ErrorLogClear
TheForm = Screen.ActiveForm.Caption
SetMyDB
Dim myset As DAO.Recordset, mytable As DAO.Recordset
EchoOn
Set myset = mydb.OpenRecordset("Select * from [>Help] Where [Form] = '" & TheForm & "' ", dbOpenDynaset, dbSeeChanges)
Dim frm As Form, ctl As Control
If Screen.ActiveForm.Name = "ProductListMaster" Then
    Set frm = Forms!ProductListMaster!ProductListControl.Form
Else
    Set frm = Screen.ActiveForm
End If
'delete/update old controls

For Each ctl In frm.Controls
    If ControlType(ctl.ControlType) = "?" Then
    ElseIf ctl.ControlName = "Key" Then
    Else
        StatusBarMessage "Checking control for additions " & ctl.ControlName
        myset.FindFirst "[Control] = '" & ctl.ControlName & "' "
        If myset.NoMatch Then
            If NNEN(ctl.StatusBarText) <> "" Then
                myset.AddNew
                ErrorLogEntry "Added Help control " & ctl.ControlName
                myset!Control = ctl.ControlName
                myset!Category = ControlType(ctl.ControlType)
                myset!Label = ctl.StatusBarText
                myset!Form = Screen.ActiveForm.Caption
                myset.Update
                myset.MoveLast
            End If
        Else
            If NNEN(ctl.StatusBarText) = "" Then
                ErrorLogEntry "Deleted Help control " & ctl.ControlName
                myset.Delete
            Else
                If ctl.StatusBarText <> NNEN(myset!Label) Then
                    ErrorLogEntry "Updated Status Bar Text for Help control " & ctl.ControlName
                    myset.Edit
                    myset!Label = ctl.StatusBarText
                    myset.Update
                End If
            End If
            If myset!Category <> ControlType(ctl.ControlType) Then
                ErrorLogEntry "Updated Control Type for Help control " & ctl.ControlName
                myset.Edit
                myset!Category = ControlType(ctl.ControlType)
                myset.Update
            End If
            'look for duplicates
            myset.FindNext "[Control] = '" & ctl.ControlName & "' "
            Do Until myset.NoMatch
                ErrorLogEntry "Deleted duplicate Help control " & ctl.ControlName
                myset.Edit
                myset!Form = Null
                myset.Update
                myset.FindNext "[Control] = '" & ctl.ControlName & "' "
            Loop
        End If
    End If
Next ctl

'look for deleted controls
myset.MoveFirst
Do Until myset.EOF
    StatusBarMessage "Checking control for deletion " & myset!Control
    FoundControl = False
    For Each ctl In frm.Controls
        If myset!Control = ctl.ControlName Then
            If ControlType(ctl.ControlType) <> "?" Then FoundControl = True
            Exit For
        End If
    Next ctl
    If Not FoundControl Then
        ErrorLogEntry "Deleted Help control " & myset!Control
        myset.Edit
        myset!Form = Null
        myset.Update
    End If
    myset.MoveNext
Loop
ErrorLogReport 1

End Function




Public Sub CloseAllForms()

Forms!Mainmenu.RecordSource = ""
Forms!Mainmenu.Requery
BeginClose:
For i = 0 To Forms.Count - 1
    If Forms(i).FormName = "MainMenu" Then
    ElseIf Forms(i).FormName = "Synchronization" Then
    ElseIf Forms(i).FormName = Screen.ActiveForm.FormName Then
    Else
        DoCmd.Close acForm, Forms(i).FormName
        GoTo BeginClose
    End If
Next i

End Sub

Public Sub HideAllForms()

For i = 0 To Forms.Count - 1
    If Forms(i).FormName = "MainMenu" Then
    ElseIf Forms(i).FormName = Screen.ActiveForm.FormName Then
        Forms(i).Visible = True
    Else
        Forms(i).Visible = False
    End If
Next i

End Sub

Public Sub RequeryForm()

On Error GoTo RequeryFormError
SaveRecord
If InStr(Screen.ActiveForm.Name, "ProductList") <> 0 Or InStr(Screen.ActiveForm.Name, "Option") <> 0 Or InStr(Screen.ActiveForm.Name, "Note") <> 0 Then
    ThisKey = Forms!ProductListMaster!ProductListControl!Key
    Forms!ProductListMaster!ProductListControl.Requery
    DoCmd.GoToControl "Key"
    DoCmd.FindRecord ThisKey
    DoCmd.GoToControl "Product"
Else
    Screen.PreviousControl.SetFocus
    ThisControl = Screen.ActiveControl.ControlName
    ThisKey = Screen.ActiveForm!Key
    DoCmd.Requery
    DoCmd.GoToControl "Key"
    DoCmd.FindRecord ThisKey
    DoCmd.GoToControl ThisControl
End If
Exit Sub

RequeryFormError:
Resume ResumeRequeryFormError
ResumeRequeryFormError:

End Sub

Public Sub SetVariable(TheName, TheVariable)

On Error GoTo SetVariableError
FindVariable:
GetSettings
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Settings] where MenuText = '" & TheName & "'", dbOpenDynaset, dbSeeChanges)
If myset.RecordCount = 0 Then 'Settings.NoMatch Then
    Set myset = mydb.OpenRecordset("Select * from [>Settings] where isnull(MenuText)", dbOpenDynaset, dbSeeChanges)
    If myset.RecordCount <> 0 Then 'Settings.MoveFirst
        myset.Edit
        GoTo EditVariable
    Else
        myset.AddNew
        GoTo EditVariable
    End If
Else
    myset.Edit
EditVariable:
    myset!MenuText = TheName
    myset!MacrotoRun = TheVariable
    If Left(TheName, 4) = "User" Then
        If NNEZ(myset!MenuCategory) < 32000 Then myset!MenuCategory = NNEZ(myset!MenuCategory) + 1
    End If
    myset.Update
End If
GetSettings
Exit Sub

SetVariableError:
Resume ResumeSetVariableError
ResumeSetVariableError:

End Sub


Public Sub SetVariableCategory(TheName, TheVariable)

GetSettings

Settings.FindFirst " [MenuText] = '" & TheName & "' "
If Settings.NoMatch Then
    MsgBox TheName & " variable not found"
Else
    Settings.Edit
EditVariable:
    Settings!MenuCategory = TheVariable
    Settings.Update
End If
GetSettings

End Sub


Public Function Variable(TheName)

GetSettings
Settings.FindFirst " [MenuText] = '" & TheName & "' "
If Settings.NoMatch Then
    SetVariable TheName, ""
    Variable = ""
Else
    Variable = NNEN(Settings!MacrotoRun)
End If
GetSettings

End Function

Public Function VariableCategory(TheName)

GetSettings
Settings.FindFirst " [MenuText] = '" & TheName & "' "
If Settings.NoMatch Then
    SetVariable TheName, ""
    VariableCategory = ""
Else
    VariableCategory = NNEN(Settings!MenuCategory)
End If
GetSettings

End Function

Public Function ApostropheCheck(TheString)

M = InStr(TheString, "'")
If M <> 0 Then
    ApostropheCheck = Left(TheString, M - 1) & Chr$(96) & Right(TheString, Len(TheString) - M)
Else
    ApostropheCheck = TheString
End If

End Function

Public Sub FilterForm(TheString)

On Error GoTo FilterFormError
If NNEN(TheString) = "" Then
    Screen.ActiveForm.FilterOn = False
Else
    Screen.ActiveForm.Filter = TheString
    Screen.ActiveForm.FilterOn = True
End If
Exit Sub

FilterFormError:
Resume ResumeFilterFormError
ResumeFilterFormError:

End Sub

Public Function Concatenate(String1, Operator, String2)

If NNEN(Operator) = "" Then Operator = "and"
If NNEN(String1) = "" Then
    Concatenate = String2
Else
    Concatenate = String1 & " " & Operator & " " & String2
End If

End Function

Public Function OpenLog()

DoCmd.OpenForm "Log"

End Function

Public Sub RestoreLocalVariables()

On Error GoTo RestoreLocalVariablesError:
Dim mytable As DAO.Recordset, frm As Form, ctl As Control, myset As DAO.Recordset
SetMyDB
If Screen.ActiveForm.Name = "ProductListMaster" Then
    Set frm = Forms!ProductListMaster!ProductListControl.Form
Else
    Set frm = Screen.ActiveForm
End If
If Screen.ActiveForm.RecordSource <> "" Then
    Set mytable = Screen.ActiveForm.RecordsetClone
End If
GetSettings
For Each ctl In frm.Controls
    If InStr(ControlType(ctl.ControlType), "box") <> 0 Then
        'ErrorLogEntry "Found in Form" & ControlType(ctl.ControlType) & " " & ctl.Name
        TheName = "Form_" & Screen.ActiveForm.Name & "_" & ctl.Name
        LocalSettings.FindFirst " [LocalSettingText5] = '" & TheName & "' "
        If LocalSettings.NoMatch Then
            'ErrorLogEntry "Not found in Form " & TheName
        Else
            SkipField = False
            If Screen.ActiveForm.RecordSource <> "" Then
                TheCount = mytable.Fields.Count
                For i = 0 To TheCount - 1
                    If mytable(i).Name = ctl.Name Then SkipField = True
                Next i
            End If
            If NNEN(ctl.Name) <> "" And ctl.Name <> "key" And ctl.Name <> "ID" Then
                If InStr(ControlType(ctl.ControlType), "check box") <> 0 Then
                    If Not SkipField Then ctl = NNEZ(LocalSettings!LocalSettingText6)
                Else
                    'If Not MessageOKCancel(ctl.Name) Then
                        If Not SkipField Then ctl = LocalSettings!LocalSettingText6
                    'End If
                End If
            End If
        End If
    End If
nextcontrol:
Next
GetSettings
Exit Sub

RestoreLocalVariablesError:
Set myset = mydb.OpenRecordset("select LocalSettingText5 from [>Local Settings] where LocalSettingText5 = '" & LocalSettings!LocalSettingText5 & "'", dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    myset.Edit
    myset!LocalSettingText5 = Null
    myset.Update
End If
ErrorLogEntry "Failed to restore " & LocalSettings!LocalSettingText6 & " into " & ctl.Name

Resume ResumeRestoreLocalVariablesError
ResumeRestoreLocalVariablesError:
GoTo nextcontrol

End Sub

Public Sub SaveLocalVariables()

ErrorLogClear
On Error GoTo SaveLocalVariablesError
Dim mytable As DAO.Recordset, frm As Form, ctl As Control
SetMyDB
If Screen.ActiveForm.Name = "ProductListMaster" Then
    Set frm = Forms!ProductListMaster!ProductListControl.Form
Else
    Set frm = Screen.ActiveForm
End If
GetSettings
DoCmd.Hourglass True
For Each ctl In frm.Controls
    If InStr(ControlType(ctl.ControlType), "box") <> 0 Then
        TheName = "Form_" & Screen.ActiveForm.FormName & "_" & ctl.Name
        LocalSettings.FindFirst " [LocalSettingText5] = '" & TheName & "' "
        If LocalSettings.NoMatch Then
        Else
            If NNEN(LocalSettings!LocalSettingText6) <> NNEN(ctl) Then
                LocalSettings.Edit
                LocalSettings!LocalSettingText6 = ctl
                LocalSettings.Update
            End If
        End If
    End If
Next
DoCmd.Hourglass False

Exit Sub

SaveLocalVariablesError:
ErrorLogEntry "Failed to save " & ctl.Name
Resume Next

End Sub



Public Function ConditionNumber(TheNumber)

If TheNumber = ".0" Then TheNumber = 0
If Val(NNEZ(TheNumber)) = 0 Then TheNumber = 0
M = InStr(TheNumber, ".")
If M <> 0 Then
    If Len(TheNumber) - M = 1 And Right(TheNumber, 2) = ".0" Then TheNumber = TheNumber \ 1
    If Len(TheNumber) - M = 2 And Right(TheNumber, 3) = ".00" Then TheNumber = TheNumber \ 1
    If Len(TheNumber) - M = 3 And Right(TheNumber, 4) = ".000" Then TheNumber = TheNumber \ 1
End If
ConditionNumber = TheNumber

End Function

Public Function HelpOpen()

On Error Resume Next
Screen.PreviousControl.SetFocus
Help

End Function

Public Function SetLocalVariableFunction(TheName, TheVariable)

SetLocalVariable TheName, TheVariable
SetLocalVariableFunction = True

End Function

Public Function SQLResult(SQLStatement As String)

On Error GoTo SQLResultError
SetMyDB
Dim myset As DAO.Recordset
Dim qd As QueryDef
QueryName = "NewQuery"
'MsgBox SQLStatement
Set qd = mydb.CreateQueryDef("New Query", SQLStatement)
Dim MySearch As DAO.Recordset
Set MySearch = qd.OpenRecordset(dbOpenSnapshot, dbSeeChanges)
If MySearch.RecordCount = 0 Then
Else
    MySearch.MoveFirst
    SQLResult = MySearch.Fields(0).Value
End If
mydb.Querydefs.Delete qd.Name

Exit Function

SQLResultError:
Resume ResumeSQLResultError
SQLResult = ""
ResumeSQLResultError:

End Function

Public Function SQLUpdate(FieldName, TableName, TheKey, TheValue As String)

On Error GoTo Error
SetMyDB
Dim MySearch As DAO.Recordset
Set MySearch = mydb.OpenRecordset("Select '" & FieldName & "' from '" & TableName & "' where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If MySearch.RecordCount = 0 Then
Else
    For i = 0 To MySearch.Fields.Count
        If MySearch.Fields(i).Name = FieldName Then
            MySearch.Edit
            MySearch.Fields(i).Value = TheValue
            MySearch.Update
        End If
    Next i
End If
Exit Function

Error:
    'MsgBox Err.Description
Resume resumeerror
resumeerror:

End Function

Public Function GotoLastForm()

On Error GoTo AppError
AppName = "Apps"
If NNEN(LocalVariable(AppName)) = "open" Then
    myappID = "Apps"
Else
    Dim s
    Set fs = CreateObject("Scripting.FileSystemObject")
    Set F = fs.GetFile("C:\Apps\" & AppName & ".mdb")
    s = F.Size
    AppName = "C:\Apps\" & AppName & ".mdb"
    On Error Resume Next
    myappID = Shell("C:\Program Files\Microsoft Office\Office\MSAccess.exe " & AppName, 1)
    myappID = Shell("C:\Program Files (x86)\Microsoft Office\Office\MSAccess.exe " & AppName, 1)
    myappID = Shell("C:\Program Files\Microsoft Office\Office11\MSAccess.exe " & AppName, 1)
    myappID = Shell("C:\Program Files (x86)\Microsoft Office\Office11\MSAccess.exe " & AppName, 1)
End If
On Error Resume Next
AppActivate myappID
Exit Function

AppError:
    MsgBox Err.Description
Resume ResumeAppError
ResumeAppError:


End Function

Public Sub Pause(ThePause)

TheTime = Timer
Do Until TheTime < Timer - ThePause
Loop

End Sub

Public Function NullControl()

Screen.ActiveControl = Null
SaveRecord

End Function

Public Function DeleteControl()

Screen.ActiveControl = Null
Screen.ActiveControl.Requery
SaveRecord

End Function

Public Function FaxReport()


End Function

Public Function CustomerData(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    theaddress = myset!TheName & Chr$(13) & Chr$(10) & ResourceAddress(myset!CompanyName, myset!Address, myset!State, myset!Zip) & Chr$(13) & Chr$(10)
    If NNEN(myset!Field3) <> "" Then
        theaddress = theaddress & Chr$(13) & Chr$(10) & "Fax " & myset!Field3
    End If
    If NNEN(myset!AreaCode) <> "" Or NNEN(myset!Field2) <> "" Then
        theaddress = theaddress & Chr$(13) & Chr$(10) & myset!AreaCode & " " & myset!Field2
    End If
    CustomerData = theaddress
End If

End Function

Public Function ResourceNameAddress(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If InStr(myset!Category, "Customer") <> 0 Then
        theaddress = ResourceID(myset!TheName) & Chr$(13) & Chr$(10) & ResourceAddress(myset!CompanyName, myset!Address, myset!State, myset!Zip) & Chr$(13) & Chr$(10)
    Else
        theaddress = ResourceAddress(myset!CompanyName, myset!Address, myset!State, myset!Zip) & Chr$(13) & Chr$(10)
    End If
    ResourceNameAddress = theaddress
End If

End Function

Public Function ResourceFirstNameAddress(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If InStr(myset!Category, "Customer") <> 0 Then
        TheName = myset!TheName
        If InStr(TheName, Chr$(13)) <> 0 Then
            TheName = Left(TheName, InStr(TheName, Chr$(13)) - 1)
        End If
        theaddress = ResourceID(TheName) & Chr$(13) & Chr$(10) & ResourceAddress(myset!CompanyName, myset!Address, myset!State, myset!Zip) & Chr$(13) & Chr$(10)
    Else
        theaddress = ResourceAddress(myset!CompanyName, myset!Address, myset!State, myset!Zip) & Chr$(13) & Chr$(10)
    End If
    ResourceFirstNameAddress = theaddress
End If

End Function

Public Function ResourceFax(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If NNEN(myset!Field3) <> "" Then
        theaddress = myset!Field3
    End If
    ResourceFax = theaddress
End If

End Function

Public Function ResourceEmail1(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Resources] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If NNEN(myset!Field3) <> "" Then
        theaddress = myset!Field4
    End If
    ResourceEmail1 = Left(theaddress, 40)
End If

End Function

Public Function JobData(TheKey)

On Error Resume Next
SetMyDB
Dim myset As DAO.Recordset, mytable As DAO.Recordset
Set myset = mydb.OpenRecordset("Select * from [>Jobs] where key = " & TheKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount <> 0 Then
    If NNEN(myset!Remarks) <> "" Then theaddress = myset!Remarks
    If NNEZ(myset!ManagedBy) <> 0 Then
        If NNEN(theaddress) <> "" Then theaddress = theaddress & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10)
        theaddress = theaddress & "Project Manager: " & SQLResult("Select ADPName from [MIS Personnel] Where Key = " & myset!ManagedBy)
    End If
    If NNEZ(myset!SpecifiedBy) <> 0 Then
        If NNEN(theaddress) <> "" Then theaddress = theaddress & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10)
        theaddress = theaddress & "Specifier: " & SQLResult("Select ADPName from [MIS Personnel] Where Key = " & myset!SpecifiedBy)
    End If
    Set mytable = mydb.OpenRecordset("Select * from [>Resources] where key = " & NNEZ(myset!Architect), dbOpenDynaset, dbSeeChanges)
    If mytable.RecordCount <> 0 Then
        If NNEN(theaddress) <> "" Then theaddress = theaddress & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10)
        theaddress = theaddress & "Architect:" & Chr$(13) & Chr$(10) & mytable!ID & Chr$(13) & Chr$(10) & ResourceAddress(mytable!CompanyName, mytable!Address, mytable!State, mytable!Zip) & Chr$(13) & Chr$(10)
        If NNEN(mytable!Field3) <> "" Then
            theaddress = theaddress & Chr$(13) & Chr$(10) & "Fax " & mytable!Field3
        End If
        If NNEN(mytable!AreaCode) <> "" Or NNEN(mytable!Field2) <> "" Then
            theaddress = theaddress & Chr$(13) & Chr$(10) & mytable!AreaCode & " " & mytable!Field2
        End If
    End If
    Set mytable = mydb.OpenRecordset("Select * from [>Resources] where key = " & NNEZ(myset!Contractor), dbOpenDynaset, dbSeeChanges)
    If mytable.RecordCount <> 0 Then
        If NNEN(theaddress) <> "" Then theaddress = theaddress & Chr$(13) & Chr$(10) & Chr$(13) & Chr$(10)
        theaddress = theaddress & "Contractor:" & Chr$(13) & Chr$(10) & mytable!ID & Chr$(13) & Chr$(10) & ResourceAddress(mytable!CompanyName, mytable!Address, mytable!State, mytable!Zip) & Chr$(13) & Chr$(10)
        If NNEN(mytable!Field3) <> "" Then
            theaddress = theaddress & Chr$(13) & Chr$(10) & "Fax " & mytable!Field3
        End If
        If NNEN(mytable!AreaCode) <> "" Or NNEN(mytable!Field2) <> "" Then
            theaddress = theaddress & Chr$(13) & Chr$(10) & mytable!AreaCode & " " & mytable!Field2
        End If
    End If
    JobData = theaddress
End If

End Function

Public Function LineFeed()

LineFeed = Chr$(13) & Chr$(10)

End Function

Public Function SetScratchPad(TheString)

On Error Resume Next
SetScratchPad = True
SetLocalVariable "ScratchPad", TheString
SaveRecord

End Function

Public Function NNE1(TheNumber)

If IsNull(TheNumber) Or TheNumber = "" Then NNE1 = 1 Else NNE1 = TheNumber

End Function

Public Function ResourceAddressPhoneFax(String1, String2, String3, String4, String5, String6, String7)

TheString1 = ResourceAddressPhone(String1, String2, String3, String4, String5, String6)
If NNEN(String7) <> "" Then TheString2 = Chr$(13) & Chr$(10) & "Fax: " & String7
ResourceAddressPhoneFax = TheString1 & TheString2

End Function

Public Function ResourcePhoneFax(String4, String5, String6)

TheString1 = ResourcePhone(String4, String5)
If NNEN(String6) <> "" Then TheString2 = Chr$(13) & Chr$(10) & "Fax: " & String6
ResourcePhoneFax = TheString1 & TheString2

End Function

Private Function Archived(Archive As Boolean)

If Archive Then
    MsgBox "This transaction cannot be changed because it is archived."
    If Password("Password") Then
    Else
        Archived = True
    End If
End If

End Function

Public Function ArchivedDate(TheDate, Archive As Boolean) As Boolean



ArchivedDate = False
If NNEZ(TheDate) = 0 Then
    'TheDate = Date
    'ArchivedDate = True
    'UndoRecord
ElseIf TheDate <> 0 Then
    GetSettings
    TheCloseYear = "1/1/" & Variable("PandL_Close_Year")
    If Year(TheDate) < SQLResult("Select FY9 from [MIS Accounts] where Number = 101") Then
        MsgBox "Transactions prior to " & SQLResult("Select FY9 from [MIS Accounts] where Number = 101") & " are archived" 'Year(Settings!ArchiveDate) & " are archived."
        ArchivedDate = True
        UndoRecord
    ElseIf Year(TheDate) < Year(Date) Then
        If InStr(Screen.ActiveForm.Name, "Balance") Then
        ElseIf Month(TheDate) > 1 Then
            If MessageOKCancel("The date you entered is in a prior year that is not yet archived. Are you sure you want to proceed?") Then
                ArchivedDate = True
                UndoRecord
            Else
                If Month(Date) <> 1 Or Day(Date) > 15 Then
                    MsgBox "Transactions later than January 15 require a password"
                    If Not Password("Account") Then
                        ArchivedDate = True
                        UndoRecord
                    End If
                End If
            End If
        End If
    'monthly closing
    Else
        If InStr(Screen.ActiveForm.Name, "Balance") Then
        Else
            TheCloseDate = VariableCategory("PandL_Close_Date") & "/" & Variable("PandL_Close_Date")
            If Year(TheDate) > Year(TheCloseYear) Then
            ElseIf Month(TheDate) > Val(VariableCategory("PandL_Close_Date")) Then
            ElseIf Month(TheDate) < Val(VariableCategory("PandL_Close_Date")) Then
                MsgBox "The date you entered is in a period that was closed on " & TheCloseDate
                ArchivedDate = True
                UndoRecord
            ElseIf Day(TheDate) <= Val(Variable("PandL_Close_Date")) Then
                MsgBox "The date you entered is in a period that was closed on " & TheCloseDate
                ArchivedDate = True
                UndoRecord
            End If
        End If
    End If
End If

End Function

Public Function NoQuotes(TheString) As String

TheID = ""
For i = 1 To Len(NNEN(TheString))
    If Asc(Mid(TheString, i, 1)) <> "34" Then TheID = TheID & Mid(TheString, i, 1)
Next i
NoQuotes = TheID

End Function

Public Function InQuotes(TheString) As String

On Error Resume Next
TheID = ""
lastChar = Len(TheString)
For i = 1 To lastChar
    If Asc(Mid(TheString, i, 1)) <> "34" Then
        TheID = TheID & Mid(TheString, i, 1)
    End If
Next i
InQuotes = Chr$(34) & TheID & Chr$(34)

End Function

Public Function ReportDimension(TheNumber As Double)

Dim DecimalPlaces As Integer
Dim TheFraction As Integer
Dim TheMeasurement As String
TheMeasurement = Forms!PartsList.Measurement
DecimalPlaces = 0
TheFraction = 0
If InStr(TheMeasurement, "1/2") Then TheFraction = 2
If InStr(TheMeasurement, "1/4") Then TheFraction = 4
If InStr(TheMeasurement, "1/8") Then TheFraction = 8
If InStr(TheMeasurement, "1/16") Then TheFraction = 16
If InStr(TheMeasurement, "1/32") Then TheFraction = 32
If InStr(TheMeasurement, "1/64") Then TheFraction = 64
If InStr(TheMeasurement, ".1") Then DecimalPlaces = 1
If InStr(TheMeasurement, ".01") Then DecimalPlaces = 2
If InStr(TheMeasurement, ".001") Then DecimalPlaces = 3
If InStr(TheMeasurement, "millimeter") <> 0 Or InStr(TheMeasurement, "mm") <> 0 Then
    ReportDimension = ConvertedNumber(TheNumber, TheMeasurement, DecimalPlaces, 0)
ElseIf InStr(TheMeasurement, "fraction") <> 0 Or InStr(TheMeasurement, "/") <> 0 Then
    ReportDimension = ConvertedNumber(TheNumber, TheMeasurement, 0, TheFraction)
Else
    ReportDimension = ConvertedNumber(TheNumber, TheMeasurement, DecimalPlaces, 0)
End If

End Function

Public Sub QueryFilter(TheFilter, QueryName)

'MsgBox TheFilter & " " & QueryName
MsgBox mydb.Querydefs.Count
For i = 1 To mydb.Querydefs.Count
    If mydb.Querydefs(i).Name = QueryName Then
        'MsgBox MyDB.QueryDefs(I).Properties.Count
        For ii = 0 To mydb.Querydefs(i).Parameters.Count - 1
            MsgBox mydb.Querydefs(i).Parameters(ii).Name
        Next ii
    End If
Next i

End Sub
Public Function PLRef1()

'ThePLRef1 = PLRef1
If [Forms].[ProductListMaster].[ProductListControl].[SelectReference1] Then
    PLRef1 = [Forms].[ProductListMaster].[ProductListControl].[Reference1Select]
Else
    PLRef1 = "[Reference1]"
End If

End Function


Public Function ReplaceQuotation(StartString, TheString, TheText)

TheFirst = InStr(1, TheString, StartString)
If TheFirst = 0 Then
    ReplaceQuotation = TheString
Else
    TheFirst = InStr(TheFirst, TheString, Chr$(34))
    TheLast = InStr(TheFirst + 1, TheString, Chr$(34))
    If TheFirst = 0 Or TheLast = 0 Then
        ReplaceQuotation = TheString
    Else
        ReplaceQuotation = Left(TheString, TheFirst) & TheText & Right(TheString, Len(TheString) - TheLast + 1)
    End If
End If

End Function

Public Function IsNumeric(TheCharacter)

If Val(TheCharacter) < 43 Then
ElseIf Val(TheCharacter) > 57 Then
ElseIf Val(TheCharacter) = 47 Then
Else
    IsNumeric = True
End If

End Function

Public Function ReplaceValue(StartString, TheString, TheText)

TheFirst = InStr(1, TheString, StartString)
TheLast = 0
If TheFirst = 0 Then
    ReplaceValue = TheString
Else
    TheFirst = TheFirst + Len(StartString)
    For i = TheFirst To Len(TheString)
        If IsNumeric(Asc(Mid(TheString, i, 1))) Then
        Else
            TheLast = i
            Exit For
        End If
    Next
    If TheFirst = 0 Or TheLast = 0 Then
        ReplaceValue = TheString
    Else
        ReplaceValue = Left(TheString, TheFirst - 1) & TheText & Mid(TheString, TheLast, Len(TheString) - TheLast)
    End If
End If

End Function

Public Function ReplaceText(StartString, TheString, TheText)

MyString = TheString
TheFirst = InStr(1, MyString, StartString)
If TheFirst <> 0 Then
    MyString = Left(MyString, TheFirst - 1) & TheText & Mid(MyString, TheFirst + Len(StartString))
End If
ReplaceText = MyString

End Function

Public Function CRLF()

CRLF = Chr$(13) & Chr$(10)

End Function

Public Function GetQuotation(StartString, TheString)

TheFirst = InStr(1, TheString, StartString)
If TheFirst = 0 Then Exit Function
TheFirst = InStr(TheFirst, TheString, Chr$(34))
TheLast = InStr(TheFirst + 1, TheString, Chr$(34))
GetQuotation = Mid(TheString, TheFirst + 1, TheLast - TheFirst - 1)

End Function

Public Function SetTableData(TheFieldName As String, TheTableName As String, TheTableKey As Long, TheFieldData As Variant) As Boolean

'This routine will save data to a table
'1) Paste the following six lines of code into your application
'2) Delete the apostrophes
'3) Fill in the four variables
'Dim TheFieldName As String, TheTableName As String, TheTableKey As Long, TheTableData As Variant
'TheFieldNameVariable = YourField'example:Screen.ActiveControl.ControlName
'TheTableNameVariable = YourTable
'TheTableKeyVariable = YourKey'example:Key
'TheFieldDataVariable = YourData'example:Screen.ActiveControl
'SetTableData TheFieldNameVariable, TheTableNameVariable, TheTableKeyVariable, TheFieldDataVariable
On Error GoTo SetTableDataError
Dim myset As DAO.Recordset
SetMyDB
Set myset = mydb.OpenRecordset("SELECT * from [" & TheTableName & "] WHERE [Key] = " & TheTableKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount = 0 Then
    MsgBox "Record number " & TheTableKey & " not found."
Else
    For i = 0 To myset.Fields.Count - 1
        If InStr(myset(i).Name, "_") Then
        ElseIf myset(i).Name = "Key" Then
        ElseIf myset(i).Name = TheFieldName Then
            myset.Edit
            myset(i) = TheFieldData
            myset.Update
            FoundField = True
            SetTableData = True
            Exit For
        End If
    Next i
    If Not FoundField Then MsgBox "Field named " & TheFieldName & " not found in " & TheTableName & " table."
End If

Exit Function

SetTableDataError:
MsgBox Err.Description
Resume ResumeSetTableDataError
ResumeSetTableDataError:
    
End Function

Public Function DuplicateRecord(TheTableName As String, TheTableKey As Long) As Boolean

'This routine will duplicate a record
'1) Paste the following four lines of code into your application
'2) Delete the apostrophes
'3) Fill in the two variables
'Dim TheTableName As String, TheTableKey As Long
'TheTableNameVariable = YourTable
'TheTableKeyVariable = YourKey'example:Key
'DuplicateRecord TheTableNameVariable, TheTableKeyVariable
On Error GoTo DuplicateRecordError
Dim myset As DAO.Recordset, mytable As DAO.Recordset
SetMyDB
Set myset = mydb.OpenRecordset("SELECT * from [" & TheTableName & "] WHERE [Key] = " & TheTableKey, dbOpenDynaset, dbSeeChanges)
If myset.RecordCount = 0 Then
    MsgBox "Record number " & TheTableKey & " not found."
Else
    Set mytable = mydb.OpenRecordset("SELECT * from [" & TheTableName & "] WHERE [Key] = " & TheTableKey, dbOpenDynaset, dbSeeChanges)
    mytable.AddNew
    mytable.Edit
    For i = 0 To myset.Fields.Count - 1
        If InStr(myset(i).Name, "_") Then
        ElseIf myset(i).Name = "Key" Then
        Else
            mytable(i) = myset(i)
        End If
    Next i
    mytable.Update
End If

Exit Function

DuplicateRecordError:
MsgBox Err.Description
Resume ResumeDuplicateRecordError
ResumeDuplicateRecordError:
    
End Function

Public Function SynchronizeApplication()

On Error GoTo Error
If Not MessageOKCancel("Synchronize application with " & ServerPath & "?") Then
g_ConnectRemotely = True
    If ConnectedToServer = 0 Then
        MsgBox "Not connected to server"
        Exit Function
    End If
    SetLocalVariable "UpdateApp", g_TheAppName
    Pause 3
    theappname = "C:\Apps\UpdateApp.mdb"
    On Error Resume Next
    myappID = Shell("C:\Program Files\Microsoft Office\Office\MSAccess.exe " & theappname, 1)
    myappID = Shell("C:\Program Files (x86)\Microsoft Office\Office\MSAccess.exe " & theappname, 1)
    myappID = Shell("C:\Program Files\Microsoft Office\Office11\MSAccess.exe " & theappname, 1)
    myappID = Shell("C:\Program Files (x86)\Microsoft Office\Office11\MSAccess.exe " & theappname, 1)
    AppActivate myappID
    Quit
End If

Exit Function

Error:
    EchoOn
    MsgBox "An error occurred while synchronizing application. " & Err.Description
Resume resumeerror
resumeerror:

End Function

Public Function IsPartner(TheKey)

If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Key] = " & TheKey)) = "Partner" Then
    IsPartner = True
Else
    IsPartner = False
End If

End Function

Public Function UserIsPartner()

If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "Partner" Then
    UserIsPartner = SQLResult("Select [Employee] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")
Else
    UserIsPartner = Forms!Sales!Partner
End If

End Function

Public Function UserKey()

'UserKey = SQLResult("Select [Key] from [MIS Personnel] Where [Text3] = 'Rich'")
UserKey = SQLResult("Select [Key] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")

End Function

Public Function UserIsManager()

If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "Project Manager" Then
    UserIsManager = SQLResult("Select [Employee] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")
Else
    UserIsManager = Forms!Sales!Manager
End If

End Function

Public Function UserIsGeneralManager() As Boolean

If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "General Manager" Then
    UserIsGeneralManager = True
Else
    UserIsGeneralManager = False
End If

End Function

Public Function UserIsOffice() As Boolean

If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "Office" Then
    UserIsOffice = True
Else
    UserIsOffice = False
End If

End Function

Public Function UserCurrentlyManager()

UserCurrentlyManager = False
If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "Project Manager" Then
    UserCurrentlyManager = True
End If

End Function

Public Function UserCurrentlyPartner()

UserCurrentlyPartner = False
If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "Partner" Then
    UserCurrentlyPartner = True
'ElseIf TheUsername = "Bill" Then
    'UserCurrentlyPartner = True
End If

End Function

Public Function UserCurrentlyMarketing()

UserCurrentlyMarketing = False
If NNEN(SQLResult("Select [Text2] from [MIS Personnel] Where [Text3] = '" & TheUsername & "'")) = "Marketing" Then
    UserCurrentlyMarketing = True
End If

End Function

Public Function DayOfYear(TheDateString As Date)

For i = 1 To 12
    If i = Month(TheDateString) Then
        TheDays = TheDays + Day(TheDateString)
        Exit For
    End If
    If i = 1 Then
        TheDays = TheDays + 31
    ElseIf i = 2 Then
        TheDays = TheDays + 28
    ElseIf i = 3 Then
        TheDays = TheDays + 31
    ElseIf i = 4 Then
        TheDays = TheDays + 30
    ElseIf i = 5 Then
        TheDays = TheDays + 31
    ElseIf i = 6 Then
        TheDays = TheDays + 30
    ElseIf i = 7 Then
        TheDays = TheDays + 31
    ElseIf i = 8 Then
        TheDays = TheDays + 31
    ElseIf i = 9 Then
        TheDays = TheDays + 30
    ElseIf i = 10 Then
        TheDays = TheDays + 31
    ElseIf i = 11 Then
        TheDays = TheDays + 30
    End If
Next i
DayOfYear = TheDays
End Function

Public Function TheQuarter(TheDate)

If Month(TheDate) <= 3 Then
    TheQuarter = "3/31/" & Year(TheDate)
ElseIf Month(TheDate) <= 6 Then
    TheQuarter = "6/30/" & Year(TheDate)
ElseIf Month(TheDate) <= 9 Then
    TheQuarter = "9/30/" & Year(TheDate)
Else
    TheQuarter = "12/31/" & Year(TheDate)
End If

End Function

Public Function TheMonth(TheDate)
'TheMonth = TheQuarter(TheDate)
'Exit Function
If Month(TheDate) = 1 Then
    TheMonth = "1/31/" & Year(TheDate)
ElseIf Month(TheDate) = 2 Then
    TheMonth = "2/28/" & Year(TheDate)
ElseIf Month(TheDate) = 3 Then
    TheMonth = "3/31/" & Year(TheDate)
ElseIf Month(TheDate) = 4 Then
    TheMonth = "4/30/" & Year(TheDate)
ElseIf Month(TheDate) = 5 Then
    TheMonth = "5/31/" & Year(TheDate)
ElseIf Month(TheDate) = 6 Then
    TheMonth = "6/30/" & Year(TheDate)
ElseIf Month(TheDate) = 7 Then
    TheMonth = "7/31/" & Year(TheDate)
ElseIf Month(TheDate) = 8 Then
    TheMonth = "8/31/" & Year(TheDate)
ElseIf Month(TheDate) = 9 Then
    TheMonth = "9/30/" & Year(TheDate)
ElseIf Month(TheDate) = 10 Then
    TheMonth = "10/31/" & Year(TheDate)
ElseIf Month(TheDate) = 11 Then
    TheMonth = "11/30/" & Year(TheDate)
ElseIf Month(TheDate) = 12 Then
    TheMonth = "12/31/" & Year(TheDate)
End If

End Function

Public Sub CreateLocalTables()

'On Error GoTo 0
SetMyDB
Dim mytable As TableDef, ProjectSchedule As DAO.Recordset, workflow As DAO.Recordset
For i = 0 To mydb.TableDefs.Count - 1
    If mydb.TableDefs(i).Name = "VOJCGoal" Then FoundTable = True
Next i
If Not FoundTable Then
    Set mytable = mydb.CreateTableDef("VOJCGoal")
    With mytable
    .Fields.Append .CreateField("TheDay", dbLong)
    .Fields.Append .CreateField("VOJC", dbLong)
    .Fields.Append .CreateField("VOJCGoal", dbLong)
    .Fields.Append .CreateField("VOJCCurrent", dbLong)
    End With
    mydb.TableDefs.Append mytable
End If
FoundTable = False
For i = 0 To mydb.TableDefs.Count - 1
    If mydb.TableDefs(i).Name = "EstimateTrend" Then FoundTable = True
Next i
If Not FoundTable Then
    Set mytable = mydb.CreateTableDef("EstimateTrend")
    With mytable
    .Fields.Append .CreateField("TrendDate", dbDate)
    .Fields.Append .CreateField("Trend1Amount", dbCurrency)
    .Fields.Append .CreateField("Trend2Amount", dbCurrency)
    .Fields.Append .CreateField("Trend3Amount", dbCurrency)
    .Fields.Append .CreateField("Trend4Amount", dbCurrency)
    .Fields.Append .CreateField("Trend1Job", dbText)
    .Fields.Append .CreateField("Trend2Job", dbText)
    .Fields.Append .CreateField("Trend3Job", dbText)
    .Fields.Append .CreateField("Trend4Job", dbText)
    End With
    mydb.TableDefs.Append mytable
End If
FoundTable = False
For i = 0 To mydb.TableDefs.Count - 1
    If mydb.TableDefs(i).Name = "BillableDesign" Then FoundTable = True
Next i
If Not FoundTable Then
    Set mytable = mydb.CreateTableDef("BillableDesign")
    With mytable
    .Fields.Append .CreateField("Date", dbDate)
    .Fields.Append .CreateField("Hours", dbSingle)
    .Fields.Append .CreateField("Job", dbLong)
    .Fields.Append .CreateField("Employee", dbText)
    .Fields.Append .CreateField("Weekof", dbText)
    .Fields.Append .CreateField("Void", dbBoolean)
    End With
    mydb.TableDefs.Append mytable
End If

End Sub

Public Sub RestartApplication()

SetLocalVariable "KRH_Restarting", True
SetLocalVariable "KRH_Closing", True
On Error Resume Next
myappID = Shell("C:\Program Files\Microsoft Office\Office\MSAccess.exe " & g_APPName, 1)
myappID = Shell("C:\Program Files (x86)\Microsoft Office\Office\MSAccess.exe " & g_APPName, 1)
myappID = Shell("C:\Program Files\Microsoft Office\Office11\MSAccess.exe " & g_APPName, 1)
myappID = Shell("C:\Program Files (x86)\Microsoft Office\Office11\MSAccess.exe " & g_APPName, 1)
'C:\Program Files (x86)
AppActivate myappID
Quit

End Sub

Public Function VerifyVariable(ThePrompt, TheVariableName)

VerifyVariable = ""
TheVariableValue = Variable(TheVariableName)
If TheVariableValue = "" Then
    MsgBox "Variable " & TheVariableName & " not found."
    Exit Function
Else
    theResponse = NNEN(InputBox(Chr$(13) & Chr$(13) & Chr$(13) & Chr$(13) & ThePrompt, "Variable", TheVariableValue))
    If theResponse = "" Then
        Exit Function
    ElseIf theResponse <> TheVariableValue Then
        If MessageOKCancel("Update variable " & TheVariableName & " from " & TheVariableValue & " to " & theResponse & "?") Then
            Exit Function
        Else
            SetVariable TheVariableName, theResponse
        End If
    Else
    End If
    VerifyVariable = theResponse
End If

End Function

Public Function ScheduleRemotely()

g_ConnectRemotely = True
If ConnectedToServer <> 0 Then
    Forms!Sales!ScheduleButton.Visible = True
    Forms!Sales!ScheduleLabel.Visible = True
Else
    MsgBox "A connection to the server could not be established"
End If

End Function

Public Function DatePlus30(TheDate As Date)

DatePlus30 = TheDate + 28

End Function

Public Function WebHelp(TheString As String)

On Error GoTo HelpError
SetVariable "User " & TheUsername & "_WebHelp_" & g_ThisForm, Str(Date)
If TheString = "All" Then
    Forms!GeneralLedger!HelpButton.HyperlinkAddress = "\\CM-PDC\Shared\App_Help\index.html"
    Forms!GeneralLedger!HelpButton.Hyperlink.Follow
ElseIf TheString = "Year End" Then
    Forms!GeneralLedger!HelpButton.HyperlinkAddress = "\\CM-PDC\Shared\App_Help\year-end-process.html"
    Forms!GeneralLedger!HelpButton.Hyperlink.Follow
ElseIf TheString = "GL" Then
    Form_GeneralLedger.HelpButton.HyperlinkAddress = "\\CM-PDC\Shared\App_Help\general-ledger.html"
    Form_GeneralLedger.HelpButton.Hyperlink.Follow
ElseIf TheString = "Accounts" And Screen.ActiveForm.Name = "Accounts" Then
    Forms!accounts!HelpButton.HyperlinkAddress = "\\CM-PDC\Shared\App_Help\accounts.html"
    Forms!accounts!HelpButton.Hyperlink.Follow
ElseIf TheString = "Accounts" And InStr(Screen.ActiveForm.Name, "Ledger") <> 0 Then
    Forms!GeneralLedger!HelpButton.HyperlinkAddress = "\\CM-PDC\Shared\App_Help\accounts.html"
    Forms!GeneralLedger!HelpButton.Hyperlink.Follow
End If

Exit Function

HelpError:
MsgBox Err.Description
Resume ResumeHelpError
ResumeHelpError:

End Function

Public Function PriorYear(TheDate As Date)

SlashCount = 0
NewDate = ""
Dim theprioryear As Date
If LeapYear(TheDate) Then TheDate = TheDate - 1
For i = 1 To Len(TheDate)
    NewDate = NewDate & Mid(TheDate, i, 1)
    If Mid(TheDate, i, 1) = "/" Then SlashCount = SlashCount + 1
    If SlashCount = 2 Then
        theprioryear = NewDate & Year(TheDate) - 1
        Exit For
    End If
Next i
If LeapYear(theprioryear) And Day(theprioryear) = 28 Then theprioryear = theprioryear + 1

PriorYear = theprioryear

End Function

Public Function LeapYear(TheDate As Date) As Boolean
leap_year = False
If Month(TheDate) <> 2 Then
ElseIf Day(TheDate) < 28 Then
ElseIf Year(TheDate) / 400 = Year(TheDate) \ 400 Then
    leap_year = True
ElseIf Year(TheDate) / 4 = Year(TheDate) \ 4 Then
   leap_year = True
End If
If leap_year Then LeapYear = True Else LeapYear = False

End Function


Public Function theWeekBegin(TheDate As Date) As Date
Do Until Weekday(TheDate) = vbMonday
    TheDate = TheDate - 1
Loop
theWeekBegin = TheDate

End Function

Public Function AccountName(AccountNumber) As String

Dim myset As DAO.Recordset
Set myset = mydb.OpenRecordset("Select [Account] from [MIS Accounts] where [Number] = " & [AccountNumber], dbOpenSnapshot, dbSeeChanges)
AccountName = myset!Account
End Function

Public Sub SetLog(TheMessage)

On Error GoTo SetLogError
SetMyDB
Dim SQLLog As DAO.Recordset
Set SQLLog = mydb.OpenRecordset("Select * from [SQL Log] where Form='" & Screen.ActiveForm.Name & "' and Message= '" & TheMessage & "' and UserName= '" & TheUsername & "'", dbOpenDynaset, dbSeeChanges)
If SQLLog.RecordCount = 0 Then
    SQLLog.AddNew
Else
    SQLLog.Edit
End If
SQLLog!username = TheUsername
SQLLog!EntryDate = Now
SQLLog!Message = TheMessage
SQLLog!Frequency = NNEZ(SQLLog!Frequency) + 1
SQLLog!Form = Screen.ActiveForm.Name
SQLLog.Update

Exit Sub
SetLogError:
    MsgBox Err.Description
    Resume ResumeSetLogError
ResumeSetLogError:

End Sub