SELECT DISTINCTROW [>Jobs].ID AS Job, IIf([DesignJob] And Not [estimate],"Design",IIf([Estimate] And Not [designjob],"Estimate",IIf([Estimate] And [designjob],"Design Estimate",""))) AS [Job Type], IIf(Not IsNull([Completed]),[Phase] & " " & [Completed],IIf([estimate] Or [designJob],[Phase] & " " & [Preliminary],[ProductionPhase])) AS Currently, [>Jobs].Key, Format([SumOfSaleAmount],"#,#") AS Agreement, Max([Sales Journal].Due) AS [Last Invoice], IIf([Family],"Parent",IIf(nnez([Parent])<>0,"Child","")) AS [Parent/Child], IIf([EstimatedPM]<>0,"Estimate","") AS Estimates, [>Jobs].DesignJob, [>Jobs].Family, [>Jobs].Delivered, [>Jobs].Closed, [>Jobs].Customer, [>Jobs].Estimate, [>Jobs].Owner
FROM (([>Jobs] LEFT JOIN [>Settings] ON [>Jobs].ProductionPhase=[>Settings].Phase) LEFT JOIN [Job Agreement Sales] ON [>Jobs].Key=[Job Agreement Sales].Key) LEFT JOIN [Sales Journal] ON [>Jobs].Key=[Sales Journal].Job
GROUP BY [>Jobs].ID, IIf([DesignJob] And Not [estimate],"Design",IIf([Estimate] And Not [designjob],"Estimate",IIf([Estimate] And [designjob],"Design Estimate",""))), IIf(Not IsNull([Completed]),[Phase] & " " & [Completed],IIf([estimate] Or [designJob],[Phase] & " " & [Preliminary],[ProductionPhase])), [>Jobs].Key, Format([SumOfSaleAmount],"#,#"), IIf([Family],"Parent",IIf(nnez([Parent])<>0,"Child","")), IIf([EstimatedPM]<>0,"Estimate",""), [>Jobs].DesignJob, [>Jobs].Family, [>Jobs].Delivered, [>Jobs].Closed, [>Jobs].Customer, [>Jobs].Estimate, [>Jobs].Owner, [>Settings].PhaseSort, IIf(nnez([Completed])<>0,[completed],IIf([Estimate] Or [designjob],[Preliminary],#1/1/2099#)), [>Jobs].ID
HAVING ((([>Jobs].ID) Is Not Null) And ((IIf(Not IsNull([Completed]),[Phase] & " " & [Completed],IIf([estimate] Or [designJob],[Phase] & " " & [Preliminary],[ProductionPhase]))) Is Not Null) And (([>Jobs].Family)=False) And (([>Jobs].Closed)=False) And (([>Jobs].Customer)<>0) And (([>Jobs].Owner)=False) And ((IIf(InStr(forms!HoursEntry!JobViewTime,"all")<>0,True,IIf(InStr(forms!HoursEntry!JobViewTime,"Design")<>0 And [DesignJob],True,IIf(InStr(Forms!HoursEntry!JobViewTime,"Estimate")<>0 And [Estimate],True,False))))=True))
ORDER BY IIf([DesignJob] And Not [estimate],"Design",IIf([Estimate] And Not [designjob],"Estimate",IIf([Estimate] And [designjob],"Design Estimate",""))), [>Settings].PhaseSort, IIf(nnez([Completed])<>0,[completed],IIf([Estimate] Or [designjob],[Preliminary],#1/1/2099#)) DESC , [>Jobs].ID;