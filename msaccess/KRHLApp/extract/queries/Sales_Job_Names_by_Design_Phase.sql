SELECT DISTINCTROW [>Jobs].ID AS Job, [>Jobs].Key, IIf(Not IsNull([Completed]),[Phase] & " " & [Completed],[ProductionPhase]) AS Currently, Format([SumOfSaleAmount],"#,#") AS Agreement, Max([Sales Journal].Due) AS [Last Invoice], IIf([DesignJob],"Design","") AS Design, IIf([Family],"Parent",IIf(nnez([Parent])<>0,"Child","")) AS [Parent/Child], Format(nnez([EstimatedPM])+nnez([EstimatedSpec])+nnez([estimatedOther])+nnez([estimatedmaterial])+nnez([estimatedsolidlumber])+nnez([estimatedveneer])+nnez([estimatedspecial])+nnez([estimatedshopstaff])+nnez([estimatedfinish])+nnez([estimatedassembly])+nnez([estimatedinstallstaff])+nnez([estimateddriving])+nnez([estimatedcontract])+nnez([estimatedofficestaff]),"#,#") AS [Estimated $], IIf([EstimatedPM]<>0,"Estimate","") AS Estimates, [>Jobs].Closed, [>Jobs].Delivered, [>Jobs].Customer, [>Jobs].Estimate, [>Jobs].Owner
FROM (([>Jobs] LEFT JOIN [>Settings] ON [>Jobs].ProductionPhase=[>Settings].Phase) LEFT JOIN [Job Agreement Sales] ON [>Jobs].Key=[Job Agreement Sales].Key) LEFT JOIN [Sales Journal] ON [>Jobs].Key=[Sales Journal].Job
GROUP BY [>Jobs].ID, [>Jobs].Key, IIf(Not IsNull([Completed]),[Phase] & " " & [Completed],[ProductionPhase]), Format([SumOfSaleAmount],"#,#"), IIf([DesignJob],"Design",""), IIf([Family],"Parent",IIf(nnez([Parent])<>0,"Child","")), Format(nnez([EstimatedPM])+nnez([EstimatedSpec])+nnez([estimatedOther])+nnez([estimatedmaterial])+nnez([estimatedsolidlumber])+nnez([estimatedveneer])+nnez([estimatedspecial])+nnez([estimatedshopstaff])+nnez([estimatedfinish])+nnez([estimatedassembly])+nnez([estimatedinstallstaff])+nnez([estimateddriving])+nnez([estimatedcontract])+nnez([estimatedofficestaff]),"#,#"), IIf([EstimatedPM]<>0,"Estimate",""), [>Jobs].Closed, [>Jobs].Delivered, [>Jobs].Customer, [>Jobs].Estimate, [>Jobs].Owner, [>Settings].PhaseSort, IIf(nnez([Completed])<>0,[completed],#1/1/2099#), [>Jobs].ID
HAVING ((([>Jobs].ID) Is Not Null) And ((IIf(Not IsNull([Completed]),[Phase] & " " & [Completed],[ProductionPhase])) Is Not Null) And (([>Jobs].Customer)<>0) And (([>Jobs].Estimate)=False) And (([>Jobs].Owner)=False) And ((IIf(InStr(Forms!Sales!viewClosed,"Open")<>0 And Not [Closed] Or InStr(forms!Sales!ViewClosed,"Closed")<>0 And [closed],True,False))=True))
ORDER BY IIf([DesignJob],"Design","") DESC , [>Settings].PhaseSort, IIf(nnez([Completed])<>0,[completed],#1/1/2099#) DESC , [>Jobs].ID;