Option Compare Database   'Use database order for string comparisons

Dim ToMinimize, TheDXFPath, TheListPath, TheXILOGPath, TheXILOGFFPath
Global g_FirstProgram, g_SizeCase, g_SizeFront, g_LastItem, g_ScreenActiveFormName, g_Xilog, g_XilogFF, g_XilogFront
Global g_TheXPosition
Global g_TheYPosition
Global g_TheZPosition, g_MillworkFolder, g_theDimensions
Global g_TheWPosition, g_Index, g_Transpose, g_Rotate, g_Flip, g_ProgramName, g_item, g_front, g_JobName, g_SequenceNo

Sub PartsTransmit()

On Error GoTo PartsTransmitError
Dim CNC As DAO.Recordset

Set fs = CreateObject("Scripting.FileSystemObject")
TheListPath = LocalVariable("Form_CNC_ListPath")
If TheListPath = "" Then
    MsgBox "Specify List Path"
    Exit Sub
Else
    If Not fs.folderexists(TheListPath & "LIST") Then
        fs.createfolder (TheListPath & "LIST")
    End If
End If
TheDXFPath = LocalVariable("Form_CNC_DXFPath")
If TheDXFPath = "" Then
    MsgBox "Specify DXF Path"
    Exit Sub
Else
    If Not fs.folderexists(TheDXFPath & "DXF") Then
        fs.createfolder (TheDXFPath & "DXF")
    End If
End If
TheXILOGPath = LocalVariable("Form_CNC_XILOGPath")
If TheXILOGPath = "" Then
    MsgBox "Specify XILOG Path"
    Exit Sub
Else
    If Not fs.folderexists(TheXILOGPath & "XILOG") Then
        fs.createfolder (TheXILOGPath & "XILOG")
    End If
End If
TheXILOGFFPath = LocalVariable("Form_CNC_XILOGFFPath")
If TheXILOGFFPath = "" Then
    MsgBox "Specify XILOGFF Path"
    Exit Sub
Else
    If Not fs.folderexists(TheXILOGFFPath & "XILOG FF") Then
        fs.createfolder (TheXILOGFFPath & "XILOG FF")
    End If
End If
    If FIsLoaded("CNC") Then
        If Screen.ActiveForm.Name = "CNC" Then g_ScreenActiveFormName = "CNC"
    End If
    If FIsLoaded("PartsList") Then
        If Screen.ActiveForm.Name = "PartsList" Then g_ScreenActiveFormName = "PartsList"
    End If
    If g_ScreenActiveFormName = "CNC" Then
        Set CNC = Forms!CNC.RecordsetClone
    Else
        Set CNC = mydb.OpenRecordset("Select * from [>CNC] where [function] = 'Size' and not IsNull([ProductList]) order by sequence")
    End If
    ErrorLogClear
    With CNC
        'StatusBarMessage "Preparing to transmit..."
        g_Xilog = ""
        g_XilogFront = ""
        g_XilogFF = ""
        DepthFactor = 0
        FirstItem = True
        ProgramList = ""
        TheProgram = ""
        TheSpace = ""
        g_SizeCase = 0
        g_SizeFront = 0
        g_ProgramName = ""
        If .RecordCount <> 0 Then
            ClearTheHead = ""
            TheMessage = ""
            .MoveLast
            TheLastRecord = .RecordCount
            thisrecord = 0
            .MoveFirst
            If InStr(NNEN(!Command), "\Header\") <> 0 Then
                FirstRecord = True
                GoTo CheckForActions
FirstRecord:
                FirstRecord = False
            End If
            TheMessage = GetQuotation("<101", !Command) & g_Transpose & ClearHead & g_Flip & g_Rotate
            TheID = "#" & SQLResult("Select [Item] from [>Product List] Where [Key] = " & !Item) & " " & !X & "x" & !Y & "x" & !Z
            g_theDimensions = ""
            If NNEZ(!X) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!X)
            If NNEZ(!Y) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!Y)
            If NNEZ(!Z) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!Z)
            If NNEZ(!ZPos) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!ZPos)
            If NNEZ(!XPos) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!XPos)
            If NNEZ(!YPos) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!YPos)
            M = 1
            Do Until M = 0
                M = InStr(1, g_theDimensions, ".")
                If M <> 0 Then
                    g_theDimensions = Left(g_theDimensions, M - 1) & "p" & Right(g_theDimensions, Len(g_theDimensions) - M)
                End If
            Loop
            g_SequenceNo = !Sequence \ 1
            If g_SequenceNo >= 30 And g_SequenceNo < 40 Then g_MillworkFolder = True Else g_MillworkFolder = False
            If g_SequenceNo < 10 Then g_SequenceNo = "0" & g_SequenceNo
            If Not TransmitBegin(ShortenProgramName(!Subassembly), TheMessage, TheID, !Item, PartEntry) Then Exit Sub
            If NNEN(ProgramList) = "" Then ProgramList = ShortenProgramName(!Subassembly)
            DoCmd.Hourglass True
            g_CNCLastSubassembly = !Subassembly
            Do Until .EOF
                thisrecord = thisrecord + 1
                DoEvents
                If g_StopExecution Then
                    StatusBarMessage "Execution stopped"
                    ErrorLogEntry "Execution stopped."
                    Exit Do
                End If
                TheCommand = NNEN(!Command)
                TheCommand = VariableCheck(TheCommand, "Transmit")
                If SQLResult("Select [Item] from [>Product List] Where [Key] = " & !Item) <> g_item And InStr(NNEN(!Command), "\Header\") = 0 Then
                    MsgBox "Expected header in record " & thisrecord & " item " & SQLResult("Select [Item] from [>Product List] Where [Key] = " & !Item) & " sequence " & !Sequence & " " & !Subassembly
                    GoTo nextrecord
                End If
                If InStr(TheCommand, "Header") <> 0 Then
                ElseIf InStr(TheCommand, "No Operation") <> 0 Then
                ElseIf InStr(TheCommand, "finished") <> 0 Then
                ElseIf InStr(TheCommand, "tasche") <> 0 Then
                ElseIf TheCommand = "" Then
                ElseIf !Sequence < 8 Then
                ElseIf !Sequence < 50 Then
                    g_ProgramName = ShortenProgramName(!Subassembly)
                    If g_XilogFront = "" Then
                        g_XilogFront = TheCommand
                    Else
                        If Right(g_XilogFront, 2) <> CRLF Then
                            g_XilogFront = g_XilogFront & CRLF & TheCommand
                        Else
                            g_XilogFront = g_XilogFront & TheCommand
                        End If
                    End If
                Else
                    'If Forms!CNC!XilogFFPathSelect And !Sequence >= 55 And !Sequence <= 59 Then
                        'g_ProgramName = ShortenProgramName(!Subassembly)
                        'If g_XilogFF = "" Then
                            'g_XilogFF = TheCommand
                        'Else
                            'If Right(g_XilogFF, 2) <> CRLF Then
                                'g_XilogFF = g_XilogFF & CRLF & TheCommand
                            'Else
                                'g_XilogFF = g_XilogFF & TheCommand
                            'End If
                        'End If
                    'Else
                        g_ProgramName = ShortenProgramName(!Subassembly)
                        If g_Xilog = "" Then
                            g_Xilog = TheCommand
                        Else
                            If Right(g_Xilog, 2) <> CRLF Then
                                g_Xilog = g_Xilog & CRLF & TheCommand
                            Else
                                g_Xilog = g_Xilog & TheCommand
                            End If
                        End If
                    'End If
                End If
                If InStr(NNEN(!Command), "\Header\") <> 0 Then

                
CheckForActions:
                    g_Flip = ""
                    g_Rotate = ""
                    If g_Xilog <> "" Then
                        Open TheXILOGPath & "Xilog\" & g_item & "_" & g_ProgramName & g_theDimensions & ".txt" For Output As #7
                        Print #7, g_Xilog
                        Close #7
                        g_Xilog = ""
                     End If
                    If g_XilogFront <> "" Then
                        Open TheXILOGPath & "Xilog Fronts\" & g_item & "_" & g_ProgramName & g_theDimensions & ".txt" For Output As #7
                        Print #7, g_XilogFront
                        Close #7
                        g_XilogFront = ""
                     End If
                    If g_XilogFF <> "" Then
                        Open TheXILOGFFPath & "Xilog FF\" & g_item & "_" & g_ProgramName & g_theDimensions & ".txt" For Output As #7
                        Print #7, g_XilogFF
                        Close #7
                        g_XilogFF = ""
                     End If
                    .MoveNext
                     Do Until CNC.EOF
                        If InStr(NNEN(!Command), "\Header\") <> 0 Then Exit Do
                        .MoveNext
                    Loop
                    .MovePrevious
                    Do Until InStr(NNEN(!Command), "\Header\") <> 0
                        .MovePrevious
                    Loop
                    g_LastItem = g_item
                    g_item = SQLResult("Select [Item] from [>Product List] Where [Key] = " & !Item)
                    If g_LastItem <> g_item Then g_SizeCase = 0: g_SizeFront = 0: g_CNCLastSubassembly = ""
                    If lastID <> TheID Then
                        lastID = TheID
                        StatusBarMessage "Transmitting item " & g_item
                    End If
                    PartEntry = !PartDescription & "," & !X & "," & !Y & "," & !Z
                    If NNEN(!MaterialSpec) <> "" Then
                        PartEntry = PartEntry & "," & !MaterialSpec
                    Else
                        PartEntry = PartEntry & ",unspecified material"
                    End If
                    If InStr(!Subassembly, "D0") <> 0 Or InStr(!Subassembly, "DR0") <> 0 Or InStr(!Subassembly, "door") <> 0 Then g_front = True Else g_front = False
                    PartEntry = PartEntry & "," & g_item
                    PartEntry = PartEntry & "," & !Quantity
                    PartEntry = PartEntry & "," & !GrainFlag
                    PartEntry = PartEntry & "," & "f"
                    PartEntry = PartEntry & "," & !FaceDependency
                    If FirstRecord Then GoTo FirstRecord
                End If
                If NNEN(TheCommand) <> "" Then
                    If g_CNCLastSubassembly <> !Subassembly And InStr(TheCommand, "\Header\") = 0 Then
                        MsgBox "Expected header in record " & thisrecord & " item " & SQLResult("Select [Item] from [>Product List] Where [Key] = " & !Item) & " sequence " & !Sequence & " " & !Subassembly
                        GoTo nextrecord
                    End If
                    If g_CNCLastSubassembly <> !Subassembly Or g_ScreenActiveFormName = "PartsList" And Not FirstItem Then 'next part
                        g_ProgramName = ShortenProgramName(!Subassembly)
                        'MsgBox g_ProgramName & " " & g_Xilog
                       'If g_Xilog <> "" Then
                            ' Open TheXILOGPath & "Xilog\" & g_item & "_" & g_ProgramName & ".txt" For Output As #7
                            'Print #7, g_Xilog
                            'Close #7
                            'g_Xilog = ""
                        'End If
                        g_SequenceNo = !Sequence \ 1
                        TheID = "#" & SQLResult("Select [Item] from [>Product List] Where [Key] = " & !Item) & " " & !X & "x" & !Y & "x" & !Z
                        g_theDimensions = ""
                        If NNEZ(!X) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!X)
                        If NNEZ(!Y) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!Y)
                        If NNEZ(!Z) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!Z)
                        If NNEZ(!ZPos) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!ZPos)
                        If NNEZ(!XPos) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!XPos)
                        If NNEZ(!YPos) <> 0 Then g_theDimensions = g_theDimensions & "_" & Tenths(!YPos)
                        M = 1
                        Do Until M = 0
                            M = InStr(1, g_theDimensions, ".")
                            If M <> 0 Then
                                g_theDimensions = Left(g_theDimensions, M - 1) & "p" & Right(g_theDimensions, Len(g_theDimensions) - M)
                            End If
                        Loop
                        If g_SequenceNo < 10 Then g_SequenceNo = "0" & g_SequenceNo
                        TheProgram = ShortenProgramName(!Subassembly)
                        ProgramList = ProgramList & ShortenProgramName(!Subassembly)
                        TransmitEnd "", TheProgram
                        TransmitResume TheProgram, TheMessage, TheID, Item, PartEntry
                    End If
                    FirstItem = False
                    'MsgBox ShortenProgramName(!SubAssembly)
                    g_CNCLastSubassembly = !Subassembly
                    If NNEN(!DXF) <> "" Then Print #1, !DXF
                End If
                If g_ScreenActiveFormName <> "CNC" Then
                Else
                    If Forms!CNC!ZWarning Then
                        If NNEZ(!Tool) <> 0 And NNEZ(!Z) <= 0 Then
                            MsgBox "Warning: " & !Sequence & " " & !Subassembly & " Z = " & !Z
                            Exit Do
                        End If
                    End If
                End If
nextrecord:
                .MoveNext
                ToMinimize = True
            Loop
            TransmitEnd "NB3615", ProgramList
        End If
    End With
    'Pause 1
    ErrorLogReport 10000
StatusBarMessage "Finished"
Pause 1
StatusBarMessage " "

'Forms!CNC!StopExecution.Visible = False
If g_ScreenActiveFormName = "PartsList" Then
    Forms!PartsList!StopExecution.Visible = False
Else
    Forms!CNC!StopExecution.Visible = False
End If
DoCmd.Hourglass False
If g_ScreenActiveFormName <> "CNC" Then
Else
    If Forms!CNC!Minimize And ToMinimize Then DoCmd.RunCommand acCmdAppMinimize
End If

Exit Sub

PartsTransmitError:
MsgBox Err.Description
Resume ResumePartsTransmitError
ResumePartsTransmitError:
End Sub


Function ShortenProgramName(TheText)

ProgramNameSubassembly = TheText
M = InStr(ProgramNameSubassembly, "00R")
If M <> 0 Then
    ProgramNameSubassembly = Left(ProgramNameSubassembly, M - 1)
Else
    M = InStr(ProgramNameSubassembly, "00S")
    If M <> 0 Then
        ProgramNameSubassembly = Left(ProgramNameSubassembly, M - 1)
    End If
End If
M = 1
Do Until M = 0
    M = InStr(1, ProgramNameSubassembly, "-")
    If M <> 0 Then
        ProgramNameSubassembly = Left(ProgramNameSubassembly, M - 1) & "_" & Right(ProgramNameSubassembly, Len(ProgramNameSubassembly) - M)
    End If
Loop

ShortenProgramName = ConditionName(ProgramNameSubassembly)

End Function


Sub SequenceEnd()

If LocalVariable("Form_CNC_CNCMachine") = "NB3615" Then
    If InStr(g_CNCFunctionDescription, "Header") <> 0 Then
        g_Rout_Start = 0
        g_Rout_End = 0
        g_lastX = g_XValue
        g_LastY = g_YValue
        g_LastZ = g_ZValue
        XDesignDraw = g_lastX
        YDesignDraw = g_LastY
        ZDesignDraw = g_LastZ
    End If
End If

End Sub

Function TransmitBegin(TheProgram, TheMessage, TheID, TheItem, PartEntry)

Set fs = CreateObject("Scripting.FileSystemObject")
If g_ScreenActiveFormName = "CNC" Then
    TheProgram = g_item & "_" & TheProgram
Else
    If Not g_front Then
        g_SizeCase = g_SizeCase + 1
        TheProgram = g_item & "_" & g_SizeCase & "_" & TheProgram
    Else
        g_SizeFront = g_SizeFront + 1
        TheProgram = g_item & "_" & g_SizeFront & "_" & TheProgram
    End If
End If
g_StopExecution = False
If g_ScreenActiveFormName = "PartsList" Then
    Forms!PartsList!StopExecution.Visible = True
Else
    Forms!CNC!StopExecution.Visible = True
    Forms!CNC.Repaint
End If
    Close #7 'xilog
    Close #6
    Close #5
    Close #4
    Close #1
    On Error GoTo ChangeDirectory 'in case it doesn"t exist
    TheListPath = LocalVariable("Form_CNC_ListPath")
    If TheListPath = "" Then
        MsgBox "Specify List Path"
        Exit Function
    Else
        If Not fs.folderexists(TheListPath & "LIST") Then
            fs.createfolder (TheListPath & "LIST")
        End If
    End If
    TheDXFPath = LocalVariable("Form_CNC_DXFPath")
    If TheDXFPath = "" Then
        MsgBox "Specify DXF Path"
        Exit Function
    Else
        If Not fs.folderexists(TheDXFPath & "DXF") Then
            fs.createfolder (TheDXFPath & "DXF")
        End If
    End If
    TheXILOGPath = LocalVariable("Form_CNC_XILOGPath")
    If TheXILOGPath = "" Then
        MsgBox "Specify XILOG Path"
        Exit Function
    Else
        If Not fs.folderexists(TheXILOGPath & "XILOG") Then
            fs.createfolder (TheXILOGPath & "XILOG")
        End If
    End If
    TheXILOGFFPath = LocalVariable("Form_CNC_XILOGFFPath")
    If TheXILOGFFPath = "" Then
        MsgBox "Specify XILOGFF Path"
        Exit Function
    Else
        If Not fs.folderexists(TheXILOGFFPath & "XILOG FF") Then
            fs.createfolder (TheXILOGFFPath & "XILOG FF")
        End If
    End If
ChangeDirectory:
    If g_ScreenActiveFormName = "CNC" Then
        ChDir TheDXFPath & "DXF\Case\"
        On Error Resume Next
        Kill "*.*"
        ChDir TheDXFPath & "DXF\Front\"
        On Error Resume Next
        Kill "*.*"
        ChDir TheDXFPath & "DXF\Millwork\"
        On Error Resume Next
        Kill "*."
        ChDir TheListPath & "List\Case\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheListPath & "List\Front\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheListPath & "List\Millwork\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheXILOGPath & "Xilog\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheXILOGPath & "Xilog\"
        On Error Resume Next
        Kill "*.pgm"
        ChDir TheXILOGPath & "Xilog Fronts\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheXILOGPath & "Xilog Fronts\"
        On Error Resume Next
        Kill "*.pgm"
        ChDir TheXILOGFFPath & "Xilog FF\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheXILOGFFPath & "Xilog FF\"
        On Error Resume Next
        Kill "*.pgm"
    Else
        ChDir TheDXFPath & "DXF\Size Case\"
        On Error Resume Next
        Kill "*.*"
        ChDir TheDXFPath & "DXF\Size Front\"
        On Error Resume Next
        Kill "*.*"
        ChDir TheListPath & "List\Size Case\"
        On Error Resume Next
        Kill "*.txt"
        ChDir TheListPath & "List\Size Front\"
        On Error Resume Next
        Kill "*.txt"
    End If
    g_JobName = SQLResult("Select ProductList from [>Product Lists] where key = " & Forms!productlistmaster!ProductListControl!ProductListName)
    If g_ScreenActiveFormName = "CNC" Then ThePartCount = LocalVariable("Form_CNC_Case_Part_Count"): Open TheDXFPath & "DXF\Case\" & g_JobName & "_CutList" & ".TXT" For Output As #4
    If g_ScreenActiveFormName = "PartsList" Then ThePartCount = LocalVariable("Form_CNC_Size_Case_Part_Count"): Open TheDXFPath & "DXF\Size Case\" & g_JobName & "_CutList" & ".TXT" For Output As #4
    Print #4, "^Job: " & SQLResult("Select ProductList from [>Product Lists] where key = " & Forms!productlistmaster!ProductListControl!ProductListName)
    Print #4, "^Description: Case parts"
    Print #4, "^Date: " & Date & " (" & Time & ")"
    Print #4, "^Parts: " & ThePartCount
    Close #4
    If g_ScreenActiveFormName = "CNC" Then ThePartCount = LocalVariable("Form_CNC_Front_Part_Count"): Open TheDXFPath & "DXF\Front\" & g_JobName & "_CutList" & ".TXT" For Output As #5
    If g_ScreenActiveFormName = "PartsList" Then ThePartCount = LocalVariable("Form_CNC_Size_Front_Part_Count"): Open TheDXFPath & "DXF\Size Front\" & g_JobName & "_CutList" & ".TXT" For Output As #5
    Print #5, "^Job: " & g_JobName
    Print #5, "^Description: Door Parts"
    Print #5, "^Date: " & Date & " (" & Time & ")"
    Print #5, "^Parts: " & ThePartCount
    Close #5
    If g_ScreenActiveFormName = "CNC" Then ThePartCount = LocalVariable("Form_CNC_Mill_Part_Count"): Open TheDXFPath & "DXF\Millwork\" & g_JobName & "_CutList" & ".TXT" For Output As #6
    Print #6, "^Job: " & g_JobName
    Print #6, "^Description: Millwork Parts"
    Print #6, "^Date: " & Date & " (" & Time & ")"
    Print #6, "^Parts: " & ThePartCount
    Close #6
    If g_ScreenActiveFormName = "CNC" Then ThePartCount = LocalVariable("Form_CNC_Case_Part_Count"): Open TheListPath & "List\Case\" & g_JobName & "_CutList" & ".TXT" For Output As #4
    If g_ScreenActiveFormName = "PartsList" Then ThePartCount = LocalVariable("Form_CNC_Size_Case_Part_Count"): Open TheListPath & "List\Size Case\" & g_JobName & "_CutList" & ".TXT" For Output As #4
    Print #4, "^Job: " & SQLResult("Select ProductList from [>Product Lists] where key = " & Forms!productlistmaster!ProductListControl!ProductListName)
    Print #4, "^Description: Case parts"
    Print #4, "^Date: " & Date & " (" & Time & ")"
    Print #4, "^Parts: " & ThePartCount
    Close #4
    If g_ScreenActiveFormName = "CNC" Then ThePartCount = LocalVariable("Form_CNC_Front_Part_Count"): Open TheListPath & "List\Front\" & g_JobName & "_CutList" & ".TXT" For Output As #5
    If g_ScreenActiveFormName = "PartsList" Then ThePartCount = LocalVariable("Form_CNC_Size_Front_Part_Count"): Open TheListPath & "List\Size Front\" & g_JobName & "_CutList" & ".TXT" For Output As #5
    Print #5, "^Job: " & g_JobName
    Print #5, "^Description: Door Parts"
    Print #5, "^Date: " & Date & " (" & Time & ")"
    Print #5, "^Parts: " & ThePartCount
    Close #5
    If g_ScreenActiveFormName = "CNC" Then ThePartCount = LocalVariable("Form_CNC_Mill_Part_Count"): Open TheListPath & "List\Millwork\" & g_JobName & "_CutList" & ".TXT" For Output As #6
    Print #6, "^Job: " & g_JobName
    Print #6, "^Description: Millwork Parts"
    Print #6, "^Date: " & Date & " (" & Time & ")"
    Print #6, "^Parts: " & ThePartCount
    Close #6
    If g_front Then
        If g_ScreenActiveFormName = "CNC" Then Open TheListPath & "List\Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
        If g_ScreenActiveFormName = "PartsList" Then Open TheListPath & "List\Size Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
        Print #5, TheProgram & ".DXF" & "," & PartEntry
        Close #5
        If g_ScreenActiveFormName = "CNC" Then Open TheDXFPath & "DXF\Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
        If g_ScreenActiveFormName = "PartsList" Then Open TheDXFPath & "DXF\Size Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
        Print #5, TheProgram & ".DXF" & "," & PartEntry
        Close #5
    End If
    If Not g_front Then
        If g_ScreenActiveFormName = "CNC" And Not g_MillworkFolder Then Open TheListPath & "List\Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
        If g_ScreenActiveFormName = "CNC" And g_MillworkFolder Then Open TheListPath & "List\Millwork\" & g_JobName & "_CutList" & ".TXT" For Append As #4
        If g_ScreenActiveFormName = "PartsList" Then Open TheListPath & "List\Size Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
        Print #4, TheProgram & ".DXF" & "," & PartEntry
        Close #4
        If g_ScreenActiveFormName = "CNC" And Not g_MillworkFolder Then Open TheDXFPath & "DXF\Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
        If g_ScreenActiveFormName = "CNC" And g_MillworkFolder Then Open TheDXFPath & "DXF\Millwork\" & g_JobName & "_CutList" & ".TXT" For Append As #4
        If g_ScreenActiveFormName = "PartsList" Then Open TheDXFPath & "DXF\Size Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
        Print #4, TheProgram & ".DXF" & "," & PartEntry
        Close #4
    Else
    End If
    If g_ScreenActiveFormName = "CNC" And g_front Then Open TheDXFPath & "DXF\Front\" & TheProgram & ".DXF" For Output As #1
    If g_ScreenActiveFormName = "CNC" And Not g_MillworkFolder And Not g_front Then Open TheDXFPath & "DXF\Case\" & TheProgram & ".DXF" For Output As #1
    If g_ScreenActiveFormName = "CNC" And g_MillworkFolder And Not g_front Then Open TheDXFPath & "DXF\Millwork\" & TheProgram & ".DXF" For Output As #1
    If g_ScreenActiveFormName = "PartsList" And g_front Then Open TheDXFPath & "DXF\Size Front\" & TheProgram & ".DXF" For Output As #1
    If g_ScreenActiveFormName = "PartsList" And Not g_front Then Open TheDXFPath & "DXF\Size Case\" & TheProgram & ".DXF" For Output As #1
    Close #3
TransmitBegin = True

Exit Function
TransmitBeginError:
MsgBox Err.Description & ". All folders in the path must exist."
Resume ResumeTransmitBeginError
ResumeTransmitBeginError:
If g_ScreenActiveFormName = "PartsList" Then
    Forms!PartsList!StopExecution.Visible = False
Else
    Forms!CNC!StopExecution.Visible = False
End If
Exit Function

End Function

Function TransmitResume(TheProgram, TheMessage, TheID, TheItem, PartEntry)

If g_ScreenActiveFormName = "CNC" Then
    TheProgram = g_item & "_" & TheProgram
    Forms!CNC.Repaint
Else
    If Not g_front Then
        g_SizeCase = g_SizeCase + 1
        TheProgram = g_item & "_" & g_SizeCase & "_" & TheProgram
    Else
        g_SizeFront = g_SizeFront + 1
        TheProgram = g_item & "_" & g_SizeFront & "_" & TheProgram
    End If
End If
Close #1
If g_front Then
    If g_ScreenActiveFormName = "CNC" Then Open TheListPath & "List\Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
    If g_ScreenActiveFormName = "PartsList" Then Open TheListPath & "List\Size Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
    Print #5, TheProgram & ".DXF" & "," & PartEntry
    Close #5
    If g_ScreenActiveFormName = "CNC" Then Open TheDXFPath & "DXF\Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
    If g_ScreenActiveFormName = "PartsList" Then Open TheDXFPath & "DXF\Size Front\" & g_JobName & "_CutList" & ".TXT" For Append As #5
    Print #5, TheProgram & ".DXF" & "," & PartEntry
    Close #5
End If
If Not g_front Then
    If g_ScreenActiveFormName = "CNC" And Not g_MillworkFolder Then Open TheListPath & "List\Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
    If g_ScreenActiveFormName = "CNC" And g_MillworkFolder Then Open TheListPath & "List\Millwork\" & g_JobName & "_CutList" & ".TXT" For Append As #4
    If g_ScreenActiveFormName = "PartsList" Then Open TheListPath & "List\Size Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
    Print #4, TheProgram & ".DXF" & "," & PartEntry
    Close #4
    If g_ScreenActiveFormName = "CNC" And Not g_MillworkFolder Then Open TheDXFPath & "DXF\Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
    If g_ScreenActiveFormName = "CNC" And g_MillworkFolder Then Open TheDXFPath & "DXF\Millwork\" & g_JobName & "_CutList" & ".TXT" For Append As #4
    If g_ScreenActiveFormName = "PartsList" Then Open TheDXFPath & "DXF\Size Case\" & g_JobName & "_CutList" & ".TXT" For Append As #4
    Print #4, TheProgram & ".DXF" & "," & PartEntry
    Close #4
End If
If g_ScreenActiveFormName = "CNC" And g_front Then Open TheDXFPath & "DXF\Front\" & TheProgram & ".DXF" For Output As #1
If g_ScreenActiveFormName = "CNC" And Not g_MillworkFolder And Not g_front Then Open TheDXFPath & "DXF\Case\" & TheProgram & ".DXF" For Output As #1
If g_ScreenActiveFormName = "CNC" And g_MillworkFolder And Not g_front Then Open TheDXFPath & "DXF\Millwork\" & TheProgram & ".DXF" For Output As #1
If g_ScreenActiveFormName = "PartsList" And g_front Then Open TheDXFPath & "DXF\Size Front\" & TheProgram & ".DXF" For Output As #1
If g_ScreenActiveFormName = "PartsList" And Not g_front Then Open TheDXFPath & "DXF\Size Case\" & TheProgram & ".DXF" For Output As #1

End Function

Sub TransmitEnd(Machine, ProgramList)

On Error GoTo TransmitEndError
TheTime = Timer
    If g_Xilog <> "" Then
        Open TheXILOGPath & "Xilog\" & g_item & "_" & g_ProgramName & g_theDimensions & ".txt" For Output As #7
        Print #7, g_Xilog
        Close #7
        g_Xilog = ""
    End If
    If g_XilogFront <> "" Then
        Open TheXILOGPath & "Xilog Fronts\" & g_item & "_" & g_ProgramName & g_theDimensions & ".txt" For Output As #7
        Print #7, g_XilogFront
        Close #7
        g_XilogFront = ""
    End If
    If g_XilogFF <> "" Then
        Open TheXILOGFFPath & "Xilog FF\" & g_item & "_" & g_ProgramName & g_theDimensions & ".txt" For Output As #7
        Print #7, g_XilogFront
        Close #7
        g_XilogFF = ""
    End If

    Close #5
    Close #4
    Print #1, "  0"
    Print #1, "ENDSEC"
    Print #1, "  0"
    Print #1, "EOF"
    Close #1
Exit Sub

TransmitEndError:

MsgBox Err.Description & " " & TheFileName
Resume ResumeTransmitEndError
ResumeTransmitEndError:

End Sub